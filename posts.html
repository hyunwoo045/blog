<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/abefa9f2433dc1b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/abefa9f2433dc1b3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-d1728c3a778f1232.js" defer=""></script><script src="/_next/static/chunks/pages/_app-74903d276c4233f7.js" defer=""></script><script src="/_next/static/chunks/pages/posts-4d7e39e6868906a0.js" defer=""></script><script src="/_next/static/cdtoWMg52IhiWI2Amhzpf/_buildManifest.js" defer=""></script><script src="/_next/static/cdtoWMg52IhiWI2Amhzpf/_ssgManifest.js" defer=""></script><style id="__jsx-971e8a04ba2bb225">.header.jsx-971e8a04ba2bb225{position:fixed;top:0;left:0;width:100%;height:60px;-webkit-box-shadow:0 2px 4px rgba(0,0,0,.1);-moz-box-shadow:0 2px 4px rgba(0,0,0,.1);box-shadow:0 2px 4px rgba(0,0,0,.1);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.logo.jsx-971e8a04ba2bb225{position:relative;left:10px;width:55px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;opacity:.6;background-color:#f00;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer}.header__title.jsx-971e8a04ba2bb225{margin-left:34px;font-size:18px;cursor:pointer}.header__nav.jsx-971e8a04ba2bb225{position:absolute;right:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item.jsx-971e8a04ba2bb225:before{content:"";width:1px;height:12px;background-color:#e5e5e5;position:absolute;top:0;bottom:0;margin:auto}.nav__item.jsx-971e8a04ba2bb225:first-child:before{display:none}.nav__item.jsx-971e8a04ba2bb225{position:relative;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item__inner.jsx-971e8a04ba2bb225{display:block;font-size:12px;padding:11px 24px;color:#656565}}}}</style><style id="__jsx-b5937f0c12fba65f">.item__box.jsx-b5937f0c12fba65f{border:1px solid#e6e6e6;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;width:90%;margin:12px;padding:12px 20px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;.box_title.jsx-b5937f0c12fba65f{font-size:21px;font-weight:700;margin:7px 0}.box_date.jsx-b5937f0c12fba65f{font-size:14px;color:#797979;margin:7px 0}.box_tags.jsx-b5937f0c12fba65f{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;margin:7px 0;.tag.jsx-b5937f0c12fba65f{font-size:11px;background-color:#868686;color:#fff;font-weight:700;-webkit-border-radius:10%;-moz-border-radius:10%;border-radius:10%;margin:1px;padding:6px}}}</style><style id="__jsx-28ecd9a38561ec3">.posts_header.jsx-28ecd9a38561ec3{height:110px;font-size:36px;font-weight:700;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);-moz-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);.page_title.jsx-28ecd9a38561ec3{position:absolute;top:40px;left:35px}}.posts_list.jsx-28ecd9a38561ec3{padding:10px;.item.jsx-28ecd9a38561ec3{cursor:pointer}}</style></head><body><div id="__next"><div class="jsx-971e8a04ba2bb225 header"><div class="jsx-971e8a04ba2bb225 logo"><img alt="main" loading="lazy" width="55" height="55" decoding="async" data-nimg="1" style="color:transparent" src="/images/ori_running.gif"/></div><div class="jsx-971e8a04ba2bb225 header__title">ë ˆë¡œë¡œì˜ ê°œë°œ ë¸Œì´ë¡œê·¸ ğŸ</div><div class="jsx-971e8a04ba2bb225 header__nav"><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner">about</span></div><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner"><a href="https://github.com/hyunwoo045"><img alt="github_logo" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/images/github_icon.png"/></a></span></div></div></div><main><div class="jsx-28ecd9a38561ec3 posts_header"><div class="jsx-28ecd9a38561ec3 page_title">Posts</div></div><div class="jsx-28ecd9a38561ec3 posts_list"><div class="jsx-28ecd9a38561ec3 item"><div class="jsx-b5937f0c12fba65f item__box"><div class="jsx-b5937f0c12fba65f box_title">ì½”ë§¥ìŠ¤ í´ë¼ìš°ë“œ 2.0 ì¸ì¦/ì—°ë™ ì„œë²„</div><div class="jsx-b5937f0c12fba65f box_date">2023-04-14</div><div class="jsx-b5937f0c12fba65f box_tags"><div class="jsx-b5937f0c12fba65f tag">Spring Boot</div><div class="jsx-b5937f0c12fba65f tag">Spring Data JPA</div><div class="jsx-b5937f0c12fba65f tag">Gitlab Pipeline</div><div class="jsx-b5937f0c12fba65f tag">Docker</div><div class="jsx-b5937f0c12fba65f tag">AWS ECS</div></div></div></div><div class="jsx-28ecd9a38561ec3 item"><div class="jsx-b5937f0c12fba65f item__box"><div class="jsx-b5937f0c12fba65f box_title">ê´€ë¦¬ì í˜ì´ì§€ - ë²„ì „ ë“±ë¡ í˜ì´ì§€ ê°œë°œ</div><div class="jsx-b5937f0c12fba65f box_date">2022-12-17</div><div class="jsx-b5937f0c12fba65f box_tags"><div class="jsx-b5937f0c12fba65f tag">Spring Boot</div><div class="jsx-b5937f0c12fba65f tag">Spring JPA</div><div class="jsx-b5937f0c12fba65f tag">Spring Web</div><div class="jsx-b5937f0c12fba65f tag">QueryDSL</div><div class="jsx-b5937f0c12fba65f tag">Vue.js</div></div></div></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"allPostsData":[{"id":0,"title":"ì½”ë§¥ìŠ¤ í´ë¼ìš°ë“œ 2.0 ì¸ì¦/ì—°ë™ ì„œë²„","date":"2023-04-14","tag":["Spring Boot","Spring Data JPA","Gitlab Pipeline","Docker","AWS ECS"],"content":"\n- ê¸°ê°„: 2022-04 ~ 2022-08, ì•½ 5ê°œì›”\n- êµ¬ì„± ì¸ì›: 1ì¸\n- ì£¼ìš” ì—…ë¬´\n    - PHP to Java ê¸°ëŠ¥ ë§ˆì´ê·¸ë ˆì´ì…˜.\n    - Spring Boot í”„ë¡œì íŠ¸ êµ¬ì„±\n    - Dockerfile ì‘ì„± (ë¹Œë“œ)\n    - Gitlab pipeline ì½”ë“œ ì‘ì„± (CI/CD ë°°í¬)\n    - AWS ECS Task ì •ì˜ ë° ì„œë¹„ìŠ¤ ìƒì„± (í´ëŸ¬ìŠ¤í„° ì •ì˜)\n- ê²°ê³¼: ì½”ë“œ ì´ê´€ ì™„ë£Œ ë° 22ë…„ 10ì›” ìƒìš© ê¸°ì¡´ ì„œë¹„ìŠ¤ ëŒ€ì²´ ë°°í¬ ì™„ë£Œ.\n- ê°œì„ ì : MSA ë‚´ íƒ€ êµ¬ì¡°ì™€ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ìœ ì§€ ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì  í™•ë³´.\n- ê¸°ìˆ  ìŠ¤íƒ\n    - Spring Boot (Java)\n    - Spring JPA (Hibernate, JPQL)\n    - Gitlab pipeline (CI/CD)\n    - Docker\n    - AWS ECS Cluster\n\n---\n\n# í”„ë¡œì íŠ¸ ì†Œê°œ\n\nMSA ë¡œ êµ¬ì„±ëœ ìì‚¬ ë°±ì—”ë“œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ëŠ” ëŒ€ë¶€ë¶„ì˜ ì„œë²„ ë°”ì´ë„ˆë¦¬ê°€ Java ë¡œ ì‘ì„±ë˜ì–´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì¸ì¦(Auth), ì—°ë™(Group) ì„œë²„ëŠ”\nPHP ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ MSA ë‚´ íƒ€ ì„œë²„ë“¤ê³¼ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì£¼ ëª©ì ì¸ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.\n\nê¸°ì¡´ ì½”ë“œê°€ ì¡´ì¬í•˜ê¸´ í•˜ë‚˜ ì‹ ê·œ í”„ë¡œì íŠ¸ë‚˜ ë‹¤ë¦„ ì—†ì—ˆìŠµë‹ˆë‹¤. ì¢‹ì€ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•˜ì—¬ ì–´ë–¤ ì ì„ ê³ ë ¤í•˜ê³  ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€\nê°„ë‹¨íˆ ì†Œê°œí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n\n---\n\n## í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì™€ì˜ ì½”ë“œ ë¶„ë¦¬\n\nì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ëŠ” ìµœëŒ€í•œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì½”ë“œë“¤ì€ ëª¨ë‘ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤.\nì—¬ê¸°ì„œ ë‚˜ë¨¸ì§€ ì½”ë“œë¼ í•¨ì€ ê°€ì¥ ë¨¼ì € 'ë¡œê¹…', 'ê²€ì¦'ê³¼ ê°™ì€ ë¡œì§ë“¤ì´ ìƒê°ì´ ë‚©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ë³„ë„ êµ¬í˜„í•œë‹¤ë©´\nê°€ë…ì„± í–¥ìƒë˜ì–´ ìœ ì§€ ë³´ìˆ˜ ìš©ì´ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆê³  ì´ í›„ í˜‘ì—…ì„ í•¨ì— ìˆì–´ íƒ€ì¸ì—ê²Œ ì½”ë“œë¥¼ ì´í•´ì‹œí‚¤ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì„ ì–»ì„ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.\n\nì•„ë˜ëŠ” ì‹¤ì œ ê¸°ì¡´ ì¸ì¦ ì„œë²„ ë‚´ ìœ ì € ì•„ì´ë””ê°€ ì¡´ì¬í•˜ëŠ” ì§€ ê²€ì‚¬í•˜ëŠ” ë©”ì„œë“œì˜ PHP ì½”ë“œë¥¼ ì¼ë¶€ ìƒëµí•œ ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```php\nclass UserController extends BaseController {\n\n    public function userExistAction() {\n  \n        $this-\u003eview-\u003edisable();\n        $response = new Response();\n      \n        $rawBody = $this-\u003erequest-\u003egetJsonRawBody(true);\n      \n        $client = CmxCommon::checkClientOrThrow($rawBody);\n      \n        $userId = $rawBody['user']['userId'];\n        if (StringUtil::isEmpty($userId)) throw new MissingMandatoryParameter(\"user.userId\");\n      \n        $users = User::getUsersByUserId($userId);\n      \n        if(sizeof($users) \u003e 0) {\n            $response-\u003esetJsonContent(\n                [\n                    'resultCode' =\u003e ResultCode::NO_ERROR,\n                    'resultMessage' =\u003e '',\n                    'exist' =\u003e true\n                ]\n            );\n            return $response;\n        } else {\n            $response-\u003esetJsonContent(\n                [\n                    'resultCode' =\u003e ResultCode::NO_ERROR,\n                    'resultMessage' =\u003e '',\n                    'exist' =\u003e false\n                ]\n            );\n        }\n\n        return $response;\n    }\n}\n```\n\nì´ë¯¸ ì¶©ë¶„íˆ ë°˜ë³µì´ ë ë§Œí•œ ë™ì‘ë“¤ì€ ë©”ì„œë“œë¡œ ë¹ ì ¸ìˆëŠ” ìƒíƒœì´ë©°, ë§¤ìš° ì½ê¸° ì¢‹ì€ ìƒíƒœì˜ ì½”ë“œì˜€ìŠµë‹ˆë‹¤. ì´ ì •ë„ì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì˜®ê²¨ ì“°ë”ë¼ë„\në¬¸ì œë  ê²ƒ í•˜ë‚˜ ì—†ì–´ ë³´ì…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì•ì„œ ë§ì”€ë“œë¦°ëŒ€ë¡œ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ **ê²€ì¦ ë¡œì§**ë“¤ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ìŠ¤ì½”í”„ ì•ˆì—ì„œ\nì½íˆì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n\n### AOP\n\nì²˜ìŒ ì œì‹œí•œ ë°©ì•ˆì€ ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•ì´ì—ˆìŠµë‹ˆë‹¤.\n\n```java\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface CheckClient {}\n```\n\nì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ì„ ìƒì„±í•˜ê³ ,\n\n```java\n@Aspect\n@Component\npublic class CheckClientAop extends BaseAop {\n    @Pointcut(\"@annotation(....annotation.CheckClient)\")\n    private void enableCheckClient() {}\n  \n    @Before(\"enableCheckClient()\")\n    public void checkClient(JoinPoint joinPoint) {\n        //... client ê²€ì¦ ë¡œì§\n    }\n}\n```\n\n`@CheckClient` ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë ¤ ìˆëŠ” í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— Client ê²€ì¦ì„ í•˜ë„ë¡ ì½”ë“œë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @Autowired\n    private UserService userService;\n  \n    @CheckClient\n    @GetMapping('/exist')\n    public boolean createUser(\n        @RequestBody UserExistReq body\n    ) {\n        String userId = body.getUserId();\n        User user = userService.getUserByUserId(userId);\n        return user != null;\n    }\n}\n```\n\ní•˜ì§€ë§Œ ìœ„ ê²€ì¦ ë¡œì§ì€ í›„ìˆ í•  ì´ìœ ë¡œ ë“œëë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ Aspect ë©”ì„œë“œëŠ” ë¡œê¹… ë° exception ì²˜ë¦¬ì— ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.\n\nì•„ë˜ëŠ” ë¡œê¹…ì„ ìœ„í•´ Aspect ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ì˜ˆì‹œì…ë‹ˆë‹¤. ìƒì„¸ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤.\n\n```java\n@Aspect\n@Component\npublic class GlobalAspect {\n    @Order(0)\n    @Around(\"within(controller..*)\")\n    public Object controllerAspectProcessor(ProceedingJoinPoint joinPoint) {\n        HttpServletReqeust request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();\n        StopWatch watch = new StopWatch();\n        try {\n            watch.start();\n            joinPoint.proceed();\n        } catch (Exception e) {\n            // handle exception\n        } finally {\n            watch.stop();\n            // log - request, watch.getTotalTimeMillis() ë“±...\n        }\n    }\n}\n```\n\n### ê²€ì¦ AOP ë¥¼ ë“œëí•œ ì´ìœ \n\n'ê²€ì¦'ì„ ë§ˆì¹œ í›„ì—ëŠ” ìš”ì²­ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Request body ì— client ì •ë³´ (id, secret)ì„ ëª…ì‹œí–ˆë‹¤ë©´\nclient ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–»ì„ ìˆ˜ ìˆê³ , Authorization í† í°ì„ ê°€ì§€ê³  ë“¤ì–´ì™”ë‹¤ë©´ ê²€ì¦ ê³¼ì •ì—ì„œ íŒŒì‹±í•˜ì—¬\nìœ ì € ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì •ë³´ëŠ” ì‹¤ì œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë“œë¬¼ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ Aspect ë©”ì„œë“œë¥¼ í†µí•´ ê²€ì¦ì„ ì§„í–‰í•˜ì˜€ë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ í˜¹ì€ ìœ ì € ì •ë³´ë¥¼ ë‹¤ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì´ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì•„ë˜ëŠ” ì´ˆê¸°ì— Aspect ë©”ì„œë“œì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ ì‹¤ì œë¡œ ì´ˆê¸°ì— ì œê°€ êµ¬ì„±í–ˆë˜ êµ¬ì¡°ì…ë‹ˆë‹¤.\n\n```java\npublic class ThreadConst {\n    public static ThreadLocal\u003cClient\u003e client = new ThreadLocal\u003c\u003e();\n}\n```\n\n```java\n@Aspect\n@Component\npublic class CheckClientAop extends BaseAop {\n  \n    @Autowired\n    private ClientService clientService;\n  \n    @Pointcut(\"@annotation(....annotation.CheckClient)\")\n    private void enableCheckClient() {}\n  \n    @Before(\"enableCheckClient()\")\n    public void checkClient(JoinPoint joinPoint) {\n        Client client = clientService.checkClientValid();\n        ThreadConst.client.set(client);\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @PostMapping('/')\n    public void createUser() {\n        System.out.println(\"ìƒˆë¡œìš´ ìœ ì €ë¥¼ ìƒì„±í•  ê±°ì—ìš”!\");\n      \n        Client client = ThreadConst.client.get();\n    }\n}\n```\n\n`ThreadConst` ë¼ëŠ” ìŠ¤ë ˆë“œ ë¡œì»¬ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¶„ë¦¬ ì½”ë“œì—ì„œ ìŠ¤ë ˆë“œ ë¡œì»¬ì— ì €ì¥í•˜ê³  ì‹¤ì œ í•¸ë“¤ëŸ¬ì—ì„œ êº¼ë‚´ì“°ëŠ”\në°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. ë™ì‘ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ” ì½”ë“œì´ì§€ë§Œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ ì² ì €íˆ í•´ì•¼ í•œë‹¤ëŠ” ì , ì˜ë„í•œ ì‘ë™ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì  ë“±\nì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì˜€ì„ ë•Œì˜ ë¬¸ì œì ë“¤ì„ ì´ìœ ë¡œ ì§€ì ë°›ì•˜ìŠµë‹ˆë‹¤.\n\nì´ë¥¼ êµ¬í˜„í•˜ëŠ” ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ **Resolver** ë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### HandlerMethodArgumentResolver\n\nì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ì¸ìê°’ë“¤ì˜ ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ ë©”ì„œë“œì— íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì„\në¶™í˜€ì„œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë°”ì¸ë”©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n`Header: Authorization` ì— Bearer í† í° ê°’ì„ ê²€ì¦í•˜ê³  í•„ìš”í•œ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ë„˜ê²¨ì£¼ëŠ”\nì‹¤ì œ ì½”ë“œë¥¼ ê°„ë‹¨íˆ ìš”ì•½í•œ ê²ƒì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.\n\n```java\n// ë°”ì¸ë”© ë§¤ê°œì²´ë¡œ ì‚¬ìš©í•  ì–´ë…¸í…Œì´ì…˜\n\n@Target({ElementType.PARAMETER})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface AuthToken {\n    boolean required() default true;\n}\n```\n\n```java\n// Resolver ì •ì˜\n\n@Component\n@RequiredArgsConstructor\npublic class AuthTokenArgumentResolver implements HandlerMethodArgumentResolver {\n  \n    @Autowired\n    private TokenParser parser;\n  \n    // ì´ ë©”ì„œë“œì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„°ì¸ì§€ë¥¼ íŒë‹¨\n    @Override\n    public boolean supportsParameter(MethodParameter parameter) {\n        return parameter.getParameterAnnotation(AuthToken.class) != null;\n    }\n\n    // supportsParameter ì—ì„œ AuthToken ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦° ì¸ìë¥¼ í™•ì¸í•˜ê³  Header ì˜ í† í°ê°’ì„ íŒŒì‹±í•˜ì—¬ í•´ë‹¹ ì¸ìì— ë°”ì¸ë”©.\n    @Override\n    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {\n        String authHeader = webRequest.getHeader(\"Authorization\");\n        if(authHeader != null) authHeader = authHeader.trim();\n        return parser.parse(authHeader);\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @PostMapping('/')\n    public void createUser(\n        @AuthToken Object token  // ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ì„œ íŒŒì‹±ë˜ì–´ í™œìš© ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ì•„ ì‚¬ìš©\n    ) {\n        String name = token.getUserName();\n    }\n}\n```\n\nì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ 'ê²€ì¦'ì— í•„ìš”í•œ ì½”ë“œë“¤ì„ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n---\n\n## ë°ì´í„°ë² ì´ìŠ¤\n\n### JPA\n\nìš”êµ¬ ì‚¬í•­ íŠ¹ì§• ìƒ ë³µì¡í•˜ê±°ë‚˜ ë™ì ì¸ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ê³  ë˜í•œ ë°ì´í„° ìì²´ê°€ ê°ì²´ë¡œì¨ íŠ¹ì •í• ë§Œí•œ ì—­í• ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—\n`mybatis` ë“±ê³¼ ê°™ì€ ORM ê°œë…ì´ ì—†ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë”ë¼ë„ ë¬¸ì œë  ê²ƒì€ ì—†ì—ˆìŠµë‹ˆë‹¤ë§Œ,\nê°œë°œìì˜ **ê°œë°œ í¸ì˜ì„±**ê³¼ ì´ ì—­ì‹œ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ JPA ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nê°€ì¥ ë¬´ë‚œí•œ `Hibernate` ORM í”„ë ˆì„ì›Œí¬ë¥¼ ì±„íƒí•˜ì˜€ìœ¼ë©° `JPQL` ë¡œ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.\n\n### Replication\n\nRead-only ë©”ì„œë“œê°€ ì••ë„ì ìœ¼ë¡œ ë§ì€ ì„œë¹„ìŠ¤ íŠ¹ì„± ìƒ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” Master-Slave êµ¬ì¡°ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆê³  Slave ë°ì´í„°ë² ì´ìŠ¤ê°€\nRead íŠ¸ëœì­ì…˜ì„ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•´ì„œ Replication ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\n```java\n@Configuration\npublic class MasterDataSourceConfig {\n\n    @Primary\n    @Bean(name = \"masterDataSource\")\n    @ConfigurationProperties(prefix = \"spring.datasource.master.hikari\")\n    public DataSource masterDataSource() {\n        return DataSourceBuilder.create()\n            .type(HikariDataSource.class)\n            .build();\n    }\n}\n```\n\n```java\n@Configuration\npublic class SlaveDataSourceConfig {\n\n    @Bean(name = \"slaveDataSource\")\n    @ConfigurationProperties(prefix = \"spring.datasource.slave.hikari\")\n    public DataSource slaveDataSource() {\n        return DataSourceBuilder.create()\n            .type(HikariDataSource.class)\n            .build();\n    }\n}\n```\n\nMaster ì„¤ì •ê³¼ Slave ì„¤ì •ì„ ë‚˜ëˆ„ì–´ ê°ì²´ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. Property ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¸ DataSource ê°€ ìƒì„±ë©ë‹ˆë‹¤.\n\nDataSource ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ê¸° ìœ„í•œ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.\n\n```java\n// Transaction ì„±ê²©ì— ë”°ë¼ ì—°ê²° ìœ í˜•ì„ ê²°ì •í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •\npublic class ReplicationRoutingDataSource extends AbstractRoutingDataSource {\n\n    @Override\n    protected Object determineCurrentLookupKey() {\n        TransactionSynchronizationManager.isCurrentTransactionReadOnly() ? DataSourceType.Slave : DataSourceType.Master;\n    }\n}\n```\n\n```java\npublic class RoutingDataSourceConfig {\n  \n    // Map ìƒì„±\n    @Bean(name = \"routingDataSource\")\n    public DataSource routingDataSource(\n        @Qualifier(\"masterDataSource\") final DataSource masterDataSource,\n        @Qualifier(\"slaveDataSource\") final DataSource slaveDataSource\n    ) {\n        ReplicationRoutingDataSource routingDataSource = new ReplicationRoutingDataSource();\n        Map\u003cObject, Object\u003e dataSourceMap = new HashMap\u003c\u003e();\n\n        dataSourceMap.put(DataSourceType.Master, masterDataSource);\n        if(useRdbSlave) dataSourceMap.put(DataSourceType.Slave, slaveDataSource);\n\n        routingDataSource.setTargetDataSources(dataSourceMap);\n        routingDataSource.setDefaultTargetDataSource(masterDataSource);\n\n        return routingDataSource;\n    }\n\n    // íŠ¸ëœì ì…˜ì´ ìƒì„±ë  ë•Œê°€ ì•„ë‹ˆë¼ ì‹¤ì œ ì¿¼ë¦¬ê°€ ë°œìƒí•  ë•Œì— connection ì„ ì ìœ í•˜ë„ë¡ ì„¤ì •\n    @Bean(name = \"dataSource\")\n    public DataSource dataSource(@Qualifier(\"routingDataSource\") DataSource routingDataSource) {\n        return new LazyConnectionDataSourceProxy(routingDataSource);\n    }\n\n    // EntityManagerFactory ì„¤ì •\n    @Bean(name = \"jpaEntityManagerFactory\")\n    public LocalContainerEntityManagerFactoryBean entityManagerFactory(@Qualifier(\"dataSource\") DataSource dataSource) {\n        Map\u003cString, Object\u003e prop = new HashMap\u003c\u003e();\n        prop.put(\"hibernate.physical_naming_strategy\", SpringPhysicalNamingStrategy.class.getName());\n        prop.put(\"hibernate.implicit_naming_strategy\", SpringImplicitNamingStrategy.class.getName());\n        prop.put(\"hibernate.hbm2ddl.auto\", env.getProperty(\"spring.jpa.hibernate.ddl-auto\"));\n\n        LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n        em.setJpaVendorAdapter(new HibernateJpaVendorAdapter());\n        em.setDataSource(dataSource);\n        em.setPackagesToScan(\"common.jpa.entity\", \"gauth.jpa.entity\");\n        em.setPersistenceUnitName(\"jpaEntityManager\");\n        em.setJpaPropertyMap(prop);\n\n        return em;\n    }\n\n    // JpaTransactionManager êµ¬í˜„ ë° bean ìœ¼ë¡œ ë“±ë¡\n    @Bean(name = \"jpaTransactionManager\")\n    public PlatformTransactionManager jpaTransactionManager(EntityManagerFactory entityManagerFactory) {\n        JpaTransactionManager transactionManager = new JpaTransactionManager();\n        transactionManager.setEntityManagerFactory(entityManagerFactory);\n        return transactionManager;\n    }\n}\n```\n\nì„¤ì •ì„ ë§ˆì³¤ìœ¼ë‹ˆ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ë³„ë¡œ íŠ¸ëœì ì…˜ì˜ ì„±ê²©ì„ ì •í•´ì£¼ì–´ ì˜¬ë°”ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¼ìš°íŒ…ë˜ë„ë¡ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @Transactional\n    @PostMapping('/')\n    public void createUser() {\n        // ...\n    }\n\n    @Transactional(readOnly = true)\n    @GetMapping('/')\n    public void getUserInfo() {\n        // ...\n    }\n}\n```\n\n## Exception\n\nì˜ˆì¸¡ ê°€ëŠ¥í•œ ë²”ìœ„ì˜ exception ë“¤ì€ ì»¤ìŠ¤í…€í•œ `RuntimeException` ì„ ë˜ì ¸ AOP ì—ì„œ ì•Œë§ëŠ” Response body ìƒì„±í•˜ì—¬\nì‘ë‹µí•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```java\npublic class BaseException extends RuntimeException {\n    public String code = \"9999\";\n    public String message = \"\";\n  \n    public BaseException(String code, String message) {\n        super(message);\n        this.code = code;\n        this.message = message;\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n\n    @GetMapping('/')\n    public void getUserInfo(\n        @RequestBody UserReq body\n    ) {\n        // ...\n        User user = userService.getUserById(body.getUserId());\n        if (user == null) throw new BaseException(400, \"User ID is not found\");\n    }\n}\n```\n\n```java\npublic class GlobalExceptionHandler {\n    public static ResponseEntity\u003cBaseResponse\u003e handle(Exception e) {\n        if (e instanceof BaseException) {\n            code = ((BaseException) e).code;\n            message = ((BaseException) e).message;\n        }\n        return BaseResponse.toResponseEntity(code, message);\n    }\n}\n```\n\n```java\n@Aspect\n@Component\npublic class GlobalAspect {\n  \n    @Order(0)\n    @Around(\"within(controller..*)\")\n    public Object controllerAspect(ProceedingJoinPoint joinPoint) {\n        Object returnObject = null;\n        try {\n            returnObject = joinPoint.proceed();\n        } catch (Exception e) {\n            returnObject = GlobalExceptionHandler.handle(e);\n        }\n      \n        return returnObject;\n    }\n}\n```\n\nException ì´ ë°œìƒí•˜ë”ë¼ë„ ì›í•˜ëŠ” í˜•íƒœì˜ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në˜í•œ í”„ë ˆì„ì›Œí¬ì—ì„œ ë°œìƒì‹œí‚¤ëŠ” exception ë“¤ì˜ ê²½ìš°ë„ ì»¤ìŠ¤í…€í•œ exception ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ìˆì—ˆê¸° ë•Œë¬¸ì— `@ControllerAdvice` ê°ì²´ë¥¼ í†µí•´ ì²˜ë¦¬í•˜ë„ë¡ ì¶”ê°€ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```java\n@ControllerAdvice\npublic class GlobalExceptionHandler {\n    public static ResponseEntity\u003cBaseResponse\u003e handle(Exception e) {\n        if (e instanceof BaseException) {\n            code = ((BaseException) e).code;\n            message = ((BaseException) e).message;\n        }\n        return BaseResponse.toResponseEntity(code, message);\n    }\n  \n    /** \n     * RequestBody ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì„ì—ë„ ë¶ˆêµ¬í•˜ê³  JSON body ê°€ ì—†ëŠ” ê²½ìš°\n     */\n    @ExceptionHandler(HttpMessageNotReadableException.class)\n    @ResponseStatus(HttpStatus.BAD_REQUEST)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, HttpMessageNotReadableException e) {\n        return GlobalExceptionHandler.handle(new ParamVerifyException(\"Something is wrong with request body: \" + e.getMessage()));\n    }\n\n    /**\n     * RequestHeader ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ í—¤ë”ê°€ ë¹„ì–´ ìˆëŠ” ê²½ìš°\n     */\n    @ExceptionHandler(MissingRequestHeaderException.class)\n    @ResponseStatus(HttpStatus.OK)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, MissingRequestHeaderException e) {\n        return GlobalExceptionHandler.handle(new MissingMandatoryHeaderException(e.getMessage()));\n    }\n\n    /**\n     * RequestParam ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ëœ ê²½ìš°\n     */\n    @ExceptionHandler(MissingServletRequestParameterException.class)\n    @ResponseStatus(HttpStatus.OK)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, MissingServletRequestParameterException e) {\n        return GlobalExceptionHandler.handle(req, new ParamVerifyException(e.getMessage()));\n    }\n}\n```\n\nìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë°œìƒ ê°€ëŠ¥í•œ Exception ì„ ìµœëŒ€í•œ ê³ ë ¤í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‹ë³„ ê°€ëŠ¥í•œ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n## ë¹Œë“œì™€ ë°°í¬\n\nDocker ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ êµ¬ë™í•˜ëŠ” ê¸°ì¡´ ë‹¤ë¥¸ ì„œë²„ì™€ ë™ì¼í•˜ê²Œ ë°°í¬ ë°©ì‹ì„ ê°€ì ¸ê°€ì•¼ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ”\nì•„ë˜ì™€ ê°™ì€ ì ë“¤ì„ ê³ ë ¤í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.\n\n1. AWS ECS cluster ì— ì„œë¹„ìŠ¤ê°€ ë“±ë¡ë  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— SSH ì ‘ì†ì„ ìœ„í•œ ì¡°ì¹˜ê°€ í•„ìš”\n2. ELK êµ¬ì¡°ë¥¼ í†µí•´ ë¡œê·¸ë¥¼ AWS OpenSearch ì„œë¹„ìŠ¤ì— ì ì¬í•˜ë¯€ë¡œ filebeat ì„¤ì •ì´ í•„ìš”\n3. develop, stage, production ìœ¼ë¡œ 3ê°€ì§€ í™˜ê²½ì´ ë‚˜ëˆ„ì–´ì§€ë¯€ë¡œ ì¶”ê°€ ì„¤ì •ì´ í•„ìš”\n\në„ì»¤íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì‹¤ì œ ì½”ë“œë¥¼ ìƒëµí•˜ê³  ë™ì‘ ìˆœì„œë¥¼ ê°„ë‹¨íˆ ì„¤ëª…í•©ë‹ˆë‹¤.\n\n```dockerfile\n# alpine ë¦¬ëˆ…ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\nFROM alpine:3.15  \n# openjdk11-jre logrotate openssh filebeat ì„¤ì¹˜\n# project ë‚´ key file ì„ ADD í•˜ê³  ê¶Œí•œ ë¶€ì—¬\n# JAVA_HOME í™˜ê²½ ë³€ìˆ˜ ë“±ë¡\n# project ë‚´ ë°”ì´ë„ˆë¦¬ ì‹¤í–‰ scriptë¥¼ ADD (entrypoint.sh)\n# project ë‚´ filebeat ì„¤ì • íŒŒì¼ì„ ADD í•˜ê³  í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬\n# build ë˜ì–´ ìˆëŠ” jar íŒŒì¼ì„ ADD\nENTRYPOINT /root/entrypoint.sh\n```\n\në°°í¬ëŠ” git commit push ì‹œ pipeline ì´ ë™ì‘í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŒ€ ë‚´ í˜•ìƒ ê´€ë¦¬ëŠ” gitlab ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°\ngitlab ì˜ CI/CD ëŠ” pipeline ìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì‹¤ì œ pipeline ì½”ë“œì—ì„œ í•µì‹¬ ì½”ë“œë§Œ ê°„ì¶”ë¦° ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```yml\nstages:\n  - versioning\n  - build\n  - deploy\n\nversioning-job:\n  stage: versioning\n  script:\n    - CURR_VER=$(cat build.gradle | grep \"version =\" | sed -E 's/version = \"(.*)\"$/\\1/')\n\nbuild-job:\n  stage: build\n  script:\n    - ./gradlew build\n    - docker build . -t cloud-v2-gauth\n\ndeploy-job:\n  stage: deploy\n  needs: [ \"versioning-job\", \"build-job\" ]\n  script:\n    #   aws-cli ECR login | AWS docker login\n    - TAG=\"$CI_COMMIT_BRANCH\"\n    - \u003e\n      if [ \"$CI_COMMIT_BRANCH\" = \"master\" ]; then\n        TAG=\"latest\"\n      fi\n  #   ì´ë¯¸ì§€ë¥¼ AWS ECR ì— í‘¸ì‹œ\n  dependencies:\n    - build-job\n```\n\nì´ì™€ ê°™ì´ êµ¬ì„±í•˜ì—¬ ì½”ë“œ í‘¸ì‹œê°€ ì¼ì–´ë‚œë‹¤ë©´ AWS ECR ì— ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ê°€ ë˜ê³ , ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ë©´\nì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (ê°œë°œ í™˜ê²½), í´ëŸ¬ìŠ¤í„° ì„œë¹„ìŠ¤ì˜ Task ì— ìƒˆ ë°°í¬ë¥¼ ì ìš©í•˜ì—¬ ì¬ì‹œì‘(ìŠ¤í…Œì´ì§€, ìƒìš© í™˜ê²½)í•˜ëŠ” ê²ƒìœ¼ë¡œ\nì‹ ê·œ ë²„ì „ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•©ë‹ˆë‹¤.\n"},{"id":1,"title":"ê´€ë¦¬ì í˜ì´ì§€ - ë²„ì „ ë“±ë¡ í˜ì´ì§€ ê°œë°œ","date":"2022-12-17","tag":["Spring Boot","Spring JPA","Spring Web","QueryDSL","Vue.js"],"content":"\n- ê¸°ê°„: 2022. 11 ~ 2022. 12, ì•½ 2ê°œì›”\n- ì£¼ìš” ì—…ë¬´: ì½”ë§¥ìŠ¤ í´ë¼ìš°ë“œ 2.0 ì–´ë“œë¯¼ í˜ì´ì§€ ë‚´ ë¦¬ì†ŒìŠ¤ ë²„ì „ ë“±ë¡ í˜ì´ì§€ ê°œë°œ\n- ì—…ë¬´ ëª©ì : ì‹¤ì œ ìœ í†µëœ ë¦¬ì†ŒìŠ¤(ì›”íŒ¨ë“œ, ë¡œë¹„í° ë“±) ë‚´ ì–´í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ ë“±ë¡/ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ í˜ì´ì§€ ê°œë°œ\n- ê°œë°œ ì¸ì›: 1ì¸\n- í”„ë¡œì íŠ¸ ìŠ¤í™\n    - Spring Boot\n    - Spring Web MVC\n    - Spring Security\n    - QueryDSL\n    - Vue.js\n\nê¸°ì¡´ ì½”ë§¥ìŠ¤ í´ë¼ìš°ë“œ 2.0 ì˜ ê´€ë¦¬ì í˜ì´ì§€ì— OTA(Over The Air) ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” ê°œë°œ ê±´ì˜\nì—¬ëŸ¬ ìš”êµ¬ì‚¬í•­ ì¤‘ ì‹ ê·œ ë²„ì „ ë“±ë¡ì„ ìœ„í•œ í˜ì´ì§€ë¥¼ ê°œë°œí•˜ëŠ” ì—…ë¬´ë¥¼ ë‹´ë‹¹í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n---\n\n## í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„\n\nê¸°ë³¸ì ìœ¼ë¡œ Spring Web MVC í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œ í”„ë¡œì íŠ¸ë¡œ Apache Tiles ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬\níƒ€ì¼ ê¸°ë°˜ì˜ ë ˆì´ì•„ì›ƒì„ êµ¬í˜„í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.\n\n```java\n\n@Configuration\npublic class WebMvcConfig implements WebMvcConfigurer {\n    public void configureViewResolvers(ViewResolverRegistry registry) {\n        TilesViewResolver viewResolver = new TilesViewResolver();\n        registry.viewResolver(viewResolver);\n    }\n\n    @Bean\n    public TilesConfigurer tilesConfigurer() {\n        TilesConfigurer tilesConfigurer = new TilesConfigurer();\n        tilesConfigurer.setDefinitions(new String[]{\n            \"/WEB-INF/layouts/**/*.tiles.xml\",\n            \"/WEB-INF/views/**/*.tiles.xml\"\n        });\n        tilesConfigurer.setCheckRefresh(true);\n        return tilesConfigurer;\n    }\n}\n```\n\nì—¬ëŸ¬ ë§ì€ íƒ€ì¼ë“¤ì´ ì •ì˜ë˜ì–´ ìˆì§€ë§Œ ê°€ì¥ í•µì‹¬ìœ¼ë¡œ ë³´ì´ëŠ” ë ˆì´ì•„ì›ƒ êµ¬ì„±ì€ ì•„ë˜ ì½”ë“œì…ë‹ˆë‹¤.\n\n```html\n\u003c!--page.layout.jsp--\u003e\n\u003chtml lang=\"ko\"\u003e\n\u003chead\u003e\n    \u003ctitle\u003e\u003c/title\u003e\n    \u003c!--....--\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv class=\"page-container\"\u003e\n    \u003cdiv class=\"page-content\"\u003e\n        \u003ctiles:insertAttribute name=\"leftmenu\"/\u003e\n        \u003cdiv class=\"content-wrapper\"\u003e\n            \u003cdiv class=\"content\"\u003e\n                \u003ctiles:insertAttribute name=\"body\"/\u003e\n                \u003ctiles:insertAttribute name=\"footer\"/\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\në©”ì¸ í˜ì´ì§€ì˜ ë ˆì´ì•„ì›ƒì„ ì •ì˜í•œ ëª¨ìŠµì…ë‹ˆë‹¤. ì•„ì£¼ ê°„ë‹¨í•´ ë³´ì´ëŠ” HTML êµ¬ì„±ì´ë©°, body attribute ì— êµ¬í˜„í•œ ë ˆì´ì•„ì›ƒì„ ì‚½ì…í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì´ êµ¬ì„±ì—\në§ì¶° `/WEB-INF/views/resource/resourcevermng` ë¼ëŠ” ë²„ì „ ê´€ë¦¬ í˜ì´ì§€ì˜ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•´ì£¼ê³  `views.tiles.xml` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ìƒˆë¡œ ë§Œë“¤ íƒ€ì¼ì˜ ì„¤ì •ì„ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n```html\n\n\u003ctiles-definitions\u003e\n    \u003cdefinition name=\"resource/resourcevermng/*\" extends=\"page.layout\"\u003e\n        \u003cput-attribute name=\"body\" value=\"/WEB-INF/views/resource/resourcevermng/{1}.jsp\"/\u003e\n    \u003c/definition\u003e\n\u003c/tiles-definitions\u003e\n```\n\n`resourcemng.jsp` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì‹¤ì œ ëœë”ë§ ë  í˜ì´ì§€ì˜ í…œí”Œë¦¿ì„ ì •ì˜í•©ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ êµ¬ì„±í•˜ëŠ” í”„ë ˆì„ì›Œí¬ëŠ” Vue.js ì´ë¯€ë¡œ Vue.js ì˜ í…œí”Œë¦¿ ë¬¸ë²•ì— ëŒ€í•œ ê¸°ì–µì„ ë”ë“¬ì–´ê°€ë©° ì½”ë”©í•˜ì˜€ìŠµë‹ˆë‹¤.\nì„¸ë¶€ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤.\n\n```html\n\n\u003cdiv id=\"rootVM\" v-cloak\u003e\n    \u003c!--...--\u003e\n\u003c/div\u003e\n\n\u003cscript type=\"text/javascript\" src=\"${contextPath}/app/resource/resourcevermng/resourcevermng.js\"/\u003e\n```\n\nìµœì´ˆ í”„ë¡œì íŠ¸ë¥¼ êµ¬í˜„í•œ ë¶„ì˜ ì˜ë„ë¥¼ ì •í™•íˆ íŒŒì•…í•  ìˆ˜ëŠ” ì—†ìœ¼ë‚˜, í•œ íŒŒì¼ì— template ê³¼ script ì½”ë“œê°€ ëª¨ë‘ ë‹¤ ë“¤ì–´ê°€ ê°€ë…ì„±ì„ í•´ì¹˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì´ ì•„ë‹ˆì—ˆì„ê¹Œ ìƒê°ë©ë‹ˆë‹¤. `contextPath`\nëŠ” constant ì „ì—­ ë³€ìˆ˜ë¡œì¨ `/src/resources/static` ì…ë‹ˆë‹¤.\n\n`src` attribute ì— ì •ì˜ëœ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì„¸ë¶€ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤.\n\n```js\nconst rootVM = new Vue({\n    name: 'RootVM',\n    el: '#rootVM',\n    created() {\n    },\n    data: {},\n    computed: {},\n    methods: {}\n})\n```\n\ní˜ì´ì§€ ë ˆì´ ì•„ì›ƒì˜ êµ¬ì„±ì„ ë§ˆì³¤ìœ¼ë‹ˆ ì´ì œ Resolver ê°€ `resource/resourcevermng/*` ì´ë¦„ì˜ íƒ€ì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë„ë¡ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.\n\n```java\n\n@Controller\n@RequestMapping(\"/resource/resourcevermng\")\npublic class ResourceVersionManageController {\n\n    @GetMappging(\"/\")\n    public String index(Model model) {\n        // model.addAttribute()  í•„ìš”í•œ ë°ì´í„°ë¥¼ ë³´ë‚´ì¤ë‹ˆë‹¤.\n        return \"/resource/resourcevermng/resourcevermng\";\n    }\n}\n```\n\n---\n\n### QueryDSL\n\nìš”êµ¬ë˜ëŠ” í˜ì´ì§€ ê¸°ëŠ¥ ìƒ ì¿¼ë¦¬ê°€ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ê·¸ì— ê´€ë ¨ ëœ êµ¬ì¡° ë˜í•œ íŒŒì•…í•  í•„ìš”ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. Spring ì˜ ORM ìŠ¤í™ ì¤‘ í•˜ë‚˜ì¸ `QueryDSL`\nì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¶€ë¶„ í•„í„°ë§ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì–´ë“œë¯¼ í˜ì´ì§€ì´ì—ˆê¸° ë•Œë¬¸ì— `QueryDSL` ì±„íƒì€ ì•„ì£¼ í•©ë¦¬ì ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.\n\nì‹¤ì œ êµ¬í˜„í•œ ì½”ë“œë¥¼ ì˜ˆì‹œë¡œ ë“¤ë©° ì„¤ëª…í•´ë³´ê² ìŠµë‹ˆë‹¤.\n\n![ota_resource_vermng](/images/ota/1.png)\n\ní™”ë©´ì— ë³´ì´ë“¯ ì´ 7ê°œì˜ ê²€ìƒ‰ í•„ë“œê°€ ì¡´ì¬í•˜ëŠ”ë° 7ê°œì˜ í•„ë“œë¥¼ ëª¨ë‘ ë‹¤ ì±„ì›Œ ê²€ìƒ‰í•´ì•¼ í•œë‹¤ë©´ ì‚¬ìš©ì„±ì´ ë§¤ìš° ë–¨ì–´ì§€ë‹ˆ ë‹¹ì—°íˆ ì¼ë¶€ í•„ë“œë§Œ ì±„ì›Œ ê²€ìƒ‰í•˜ë”ë¼ë„ í•„í„°ê°€ ì ìš©ëœ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ JPA ì˜\nì¼ë°˜ì ì¸ ì¿¼ë¦¬ ë©”ì„œë“œë¡œ êµ¬í˜„í•œë‹¤ê³  í•˜ë©´ ì´ í•œ ê¸°ëŠ¥ì„ ìœ„í•´ ìˆ˜ë„ ì—†ì´ ë§ì€ ë©”ì„œë“œë¥¼ ì •ì˜í•´ì•¼ í–ˆì„ ê²ƒì…ë‹ˆë‹¤.\n\n```java\n// ì‹¤ì œ ì½”ë“œê°€ ì•„ë‹Œ ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n@Repository\npublic interface ResourceVersionRepository extends JpaRepository\u003cResourceVersion, Long\u003e {\n    List\u003cResourceVersion\u003e findByModelName(String modelName);\n\n    List\u003cResourceVersion\u003e findByModelNameAndModelType(String modelName, String modelType);\n\n    List\u003cResourceVersion\u003e findByModelNameAndModelTypeAndVersion(String modelName, String modelType, String version);\n    // .....ìˆ˜ì‹­ê°œì˜ method T_T\n}\n```\n\nì´ëŸ° ìƒí™©ì—ì„œëŠ” ë™ì  ì¿¼ë¦¬ê°€ ì‘ì„± ê°€ëŠ¥í•œ ë°©ë²•ì„ ì°¾ì•„ì•¼ í•˜ëŠ”ë° `QueryDSL` ì€ ì´ë¥¼ í•´ê²°í•´ì¤„ JPQL ë¹Œë”ì…ë‹ˆë‹¤.\n\nê¸°ì¡´ ì„¤ì •ì´ ì´ë¯¸ ì™„ë£Œë˜ì–´ ìˆê³  ì»´íŒŒì¼ ì‹œ `/target/generated-sources/java/{package}/entity` ì•„ë˜ QModel ë“¤ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìœ¼ë‹ˆ ì¶”ê°€ëœ í…Œì´ë¸”ì„ ì •ì˜í•©ë‹ˆë‹¤. ì‹¤ì œ\nì½”ë“œì™€ëŠ” ë‹¤ë¥¸ ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```java\n\n@Entity\n@Getter\n@Setter\n@Table(name = \"tbl_resource_version\")\npublic class ResourceVersion {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(columnDefinition = \"int\")\n    private Long seqno;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"modelSeqno\")\n    private ResourceModel model;\n\n    private String version;\n\n    private String registerAdmin;\n\n    private String updateAdmin;\n\n    @Column(columnDefinition = \"int\")\n    private Long registerTs;\n\n    @Column(columnDefinition = \"int\")\n    private Long updateTs;\n}\n```\n\nì´ í›„ ë‹¤ì‹œ ì»´íŒŒì¼í•˜ë©´ `QResourceVersion` ì´ë¼ëŠ” ìƒˆë¡œìš´ QModel ì´ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n```java\n\n@Generated(\"com.querydsl.codegen.EntitySerializer\")\npublic class QResourceVersion extends EntityPathBase\u003cResourceVersion\u003e {\n    //...\n}\n```\n\në™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì—­ì‹œ ì‹¤ì œ ì½”ë“œì™€ ë‹¤ë¥¸ ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```java\n\n@Repository\npublic class ResourceVersionRepository {\n\n    @Autowired\n    private JPAQueryFactory queryFactory;\n\n    /**\n     * SearchMap ì€ ServletRequest ë¥¼ HashMap\u003cString, Object\u003e ì˜ í˜•íƒœë¡œ ë³€í™˜ì‹œí‚¨ ê°ì²´ì…ë‹ˆë‹¤.\n     */\n    public QueryResults\u003cTuple\u003e queryVersionList(SearchMap map, Sort sort) {\n        BooleanBuilder filter = new BooleanBuilder();\n        QResourceVersion v = new QResourceVersion(\"v\");\n        QResourceModel m = new QResourceModel(\"m\");\n\n        if (map != null) {\n            String modelName = (String) map.get(\"modelName\");\n            String modelType = (String) map.get(\"modelType\");\n            String version = (String) map.get(\"version\");\n\n            // ë™ì  ì¿¼ë¦¬ ì¡°ê±´ë¬¸ ì¶”ê°€ \n            if (modelName != null) filter.and(m.modelName.eq(modelName));\n            if (modelType != null) filter.and(m.modelType.eq(modelType));\n            if (version != null) filter.and(v.version.eq(version));\n\n            // ì¿¼ë¦¬ ì‹¤í–‰\n            JPAQuery\u003cTuple\u003e query = queryFactory\n                .select(m.modelName, m.modelType, v.version)\n                .from(v)\n                .leftJoin(v.model(), m)\n                .where(filter);\n\n            return query.fetResults();\n        } else {\n            // í•„í„° ì—†ì´ ì „ì²´ ê²€ìƒ‰...\n        }\n    }\n}\n```\n\nì´ í›„ `QueryResults\u003cTuple\u003e` í˜•íƒœì˜ ê²°ê³¼ê°’ì€ DTO í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ í˜ì´ì§€ì— ì „ë‹¬í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n---\n\n## AWS S3 ì— ë°”ì´ë„ˆë¦¬ ì—…ë¡œë“œ\n\nJavaScript ìš© AWS SDK ê°€\nìˆìŠµë‹ˆë‹¤. [ê³µì‹ ë¬¸ì„œ](https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/welcome.html) ë¥¼ ì°¸ê³ í•˜ì—¬ AWS S3 ì— ì—…ë¡œë“œê°€\nê°€ëŠ¥í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.\n\nì•ë‹¨ì€ ì—„ë°€íˆ ë”°ì§€ìë©´ Node.js í”„ë¡œì íŠ¸ê°€ ì•„ë‹ˆë¯€ë¡œ ë¸Œë¼ìš°ì € ìŠ¤í¬ë¦½íŠ¸ë¡œ SDK ë¥¼ í¬í•¨ì‹œì¼œì•¼ í–ˆìŠµë‹ˆë‹¤.\n\n```html\n\u003c!--resourcevermng.jsp--\u003e\n\n\u003c!-- ..... --\u003e\n\u003cscript src=\"https://sdk.amazonaws.com/js/aws-sdk-2.1254.0.min.js\u003e\u003c/script\u003e\n```\n\nAWS ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸°\nìœ„í•´ [ê³µì‹ ë¬¸ì„œ](https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/getting-started-browser.html) ì˜ 1ë‹¨ê³„,\n2ë‹¨ê³„ ë‚´ìš©ì„ ì°¸ê³ í•˜ì—¬ CognitoIdentity Pool ì„ ìƒì„±í•˜ê³  ì •ì±…ì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ í›„ ê¶Œí•œì„ ê°€ì§„ Pool ID ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í¬í•¨ì‹œí‚¨ SDK ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.\n\në§ˆì§€ë§‰ìœ¼ë¡œ ì—­ì‹œ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ í˜ì´ì§€ì—ì„œ ì „ë‹¬ë°›ì€ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ AWS S3ì— ì—…ë¡œë“œ í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```js\nasync function uploadFileToS3() {\n    // ...v-model \u003e closure. file ì— ê´€í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜´\n    \n    var credentials = new AWS.CognitoIdentityCredentials({\n        IdentityPoolId: 'ap-northeast-2:key...'\n    });\n    AWS.config.update({\n        region: 'ap-northeast-2',\n        credentials,\n    });\n    let s3 = new AWS.s3({\n        computeChecksums: true\n    });\n    let body = {\n        Bucket: 'bucket-name',\n        Body: file,\n        Key: fileName\n    }\n    const putResult = await s3.putObject(body).promise();\n}\n\n```\n\n"}]},"__N_SSG":true},"page":"/posts","query":{},"buildId":"cdtoWMg52IhiWI2Amhzpf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>