<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/abefa9f2433dc1b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/abefa9f2433dc1b3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-d1728c3a778f1232.js" defer=""></script><script src="/_next/static/chunks/pages/_app-74903d276c4233f7.js" defer=""></script><script src="/_next/static/chunks/570-bdec8792f1cf9171.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-ca43962f59c7d3c7.js" defer=""></script><script src="/_next/static/9VLAmBO7HTcZ8hJKXyxbp/_buildManifest.js" defer=""></script><script src="/_next/static/9VLAmBO7HTcZ8hJKXyxbp/_ssgManifest.js" defer=""></script><style id="__jsx-971e8a04ba2bb225">.header.jsx-971e8a04ba2bb225{position:fixed;top:0;left:0;width:100%;height:60px;-webkit-box-shadow:0 2px 4px rgba(0,0,0,.1);-moz-box-shadow:0 2px 4px rgba(0,0,0,.1);box-shadow:0 2px 4px rgba(0,0,0,.1);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.logo.jsx-971e8a04ba2bb225{position:relative;left:10px;width:55px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;opacity:.6;background-color:#f00;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer}.header__title.jsx-971e8a04ba2bb225{margin-left:34px;font-size:18px;cursor:pointer}.header__nav.jsx-971e8a04ba2bb225{position:absolute;right:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item.jsx-971e8a04ba2bb225:before{content:"";width:1px;height:12px;background-color:#e5e5e5;position:absolute;top:0;bottom:0;margin:auto}.nav__item.jsx-971e8a04ba2bb225:first-child:before{display:none}.nav__item.jsx-971e8a04ba2bb225{position:relative;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item__inner.jsx-971e8a04ba2bb225{display:block;font-size:12px;padding:11px 24px;color:#656565}}}}</style><style id="__jsx-4eaf6378c4a9ee0a">.page__content.jsx-4eaf6378c4a9ee0a{width:76%;margin:auto}pre.jsx-4eaf6378c4a9ee0a{font-size:11px}</style></head><body><div id="__next"><div class="jsx-971e8a04ba2bb225 header"><div class="jsx-971e8a04ba2bb225 logo"><img alt="main" loading="lazy" width="55" height="55" decoding="async" data-nimg="1" style="color:transparent" src="/images/ori_running.gif"/></div><div class="jsx-971e8a04ba2bb225 header__title">ë ˆë¡œë¡œì˜ ê°œë°œ ë¸Œì´ë¡œê·¸ ğŸ</div><div class="jsx-971e8a04ba2bb225 header__nav"><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner">about</span></div><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner"><a href="https://github.com/hyunwoo045"><img alt="github_logo" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/images/github_icon.png"/></a></span></div></div></div><main><div class="post__content"><section class="jsx-4eaf6378c4a9ee0a page__content e-content"><ul>
<li>ê¸°ê°„: 2022-04 ~ 2022-08, ì•½ 5ê°œì›”</li>
<li>êµ¬ì„± ì¸ì›: 1ì¸</li>
<li>ì£¼ìš” ì—…ë¬´<!-- -->
<ul>
<li>PHP to Java ê¸°ëŠ¥ ë§ˆì´ê·¸ë ˆì´ì…˜.</li>
<li>Spring Boot í”„ë¡œì íŠ¸ êµ¬ì„±</li>
<li>Dockerfile ì‘ì„± (ë¹Œë“œ)</li>
<li>Gitlab pipeline ì½”ë“œ ì‘ì„± (CI/CD ë°°í¬)</li>
<li>AWS ECS Task ì •ì˜ ë° ì„œë¹„ìŠ¤ ìƒì„± (í´ëŸ¬ìŠ¤í„° ì •ì˜)</li>
</ul>
</li>
<li>ê²°ê³¼: ì½”ë“œ ì´ê´€ ì™„ë£Œ ë° 22ë…„ 10ì›” ìƒìš© ê¸°ì¡´ ì„œë¹„ìŠ¤ ëŒ€ì²´ ë°°í¬ ì™„ë£Œ.</li>
<li>ê°œì„ ì : MSA ë‚´ íƒ€ êµ¬ì¡°ì™€ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ìœ ì§€ ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì  í™•ë³´.</li>
<li>ê¸°ìˆ  ìŠ¤íƒ<!-- -->
<ul>
<li>Spring Boot (Java)</li>
<li>Spring JPA (Hibernate, JPQL)</li>
<li>Gitlab pipeline (CI/CD)</li>
<li>Docker</li>
<li>AWS ECS Cluster</li>
</ul>
</li>
</ul>
<hr/>
<h1>í”„ë¡œì íŠ¸ ì†Œê°œ</h1>
<p>MSA ë¡œ êµ¬ì„±ëœ ìì‚¬ ë°±ì—”ë“œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ëŠ” ëŒ€ë¶€ë¶„ì˜ ì„œë²„ ë°”ì´ë„ˆë¦¬ê°€ Java ë¡œ ì‘ì„±ë˜ì–´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì¸ì¦(Auth), ì—°ë™(Group) ì„œë²„ëŠ”
PHP ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ MSA ë‚´ íƒ€ ì„œë²„ë“¤ê³¼ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì£¼ ëª©ì ì¸ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.</p>
<p>ê¸°ì¡´ ì½”ë“œê°€ ì¡´ì¬í•˜ê¸´ í•˜ë‚˜ ì‹ ê·œ í”„ë¡œì íŠ¸ë‚˜ ë‹¤ë¦„ ì—†ì—ˆìŠµë‹ˆë‹¤. ì¢‹ì€ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•˜ì—¬ ì–´ë–¤ ì ì„ ê³ ë ¤í•˜ê³  ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€
ê°„ë‹¨íˆ ì†Œê°œí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>
<hr/>
<h2>í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì™€ì˜ ì½”ë“œ ë¶„ë¦¬</h2>
<p>ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ëŠ” ìµœëŒ€í•œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì½”ë“œë“¤ì€ ëª¨ë‘ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤.
ì—¬ê¸°ì„œ ë‚˜ë¨¸ì§€ ì½”ë“œë¼ í•¨ì€ ê°€ì¥ ë¨¼ì € &#x27;ë¡œê¹…&#x27;, &#x27;ê²€ì¦&#x27;ê³¼ ê°™ì€ ë¡œì§ë“¤ì´ ìƒê°ì´ ë‚©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ë³„ë„ êµ¬í˜„í•œë‹¤ë©´
ê°€ë…ì„± í–¥ìƒë˜ì–´ ìœ ì§€ ë³´ìˆ˜ ìš©ì´ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆê³  ì´ í›„ í˜‘ì—…ì„ í•¨ì— ìˆì–´ íƒ€ì¸ì—ê²Œ ì½”ë“œë¥¼ ì´í•´ì‹œí‚¤ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì„ ì–»ì„ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.</p>
<p>ì•„ë˜ëŠ” ì‹¤ì œ ê¸°ì¡´ ì¸ì¦ ì„œë²„ ë‚´ ìœ ì € ì•„ì´ë””ê°€ ì¡´ì¬í•˜ëŠ” ì§€ ê²€ì‚¬í•˜ëŠ” ë©”ì„œë“œì˜ PHP ì½”ë“œë¥¼ ì¼ë¶€ ìƒëµí•œ ì˜ˆì‹œì…ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-php" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">class</span><span> </span><span class="token class-name-definition" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">BaseController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token function-definition" style="color:#DD4A68">userExistAction</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>        </span><span class="token this" style="color:#07a">$this</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#905">view</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#DD4A68">disable</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#e90">$response</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">Response</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#e90">$rawBody</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token this" style="color:#07a">$this</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#905">request</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#DD4A68">getJsonRawBody</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#e90">$client</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token scope">CmxCommon</span><span class="token scope" style="color:#999">::</span><span class="token" style="color:#DD4A68">checkClientOrThrow</span><span class="token" style="color:#999">(</span><span class="token" style="color:#e90">$rawBody</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#e90">$userId</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#e90">$rawBody</span><span class="token" style="color:#999">[</span><span class="token single-quoted-string" style="color:#690">&#x27;user&#x27;</span><span class="token" style="color:#999">]</span><span class="token" style="color:#999">[</span><span class="token single-quoted-string" style="color:#690">&#x27;userId&#x27;</span><span class="token" style="color:#999">]</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span class="token scope">StringUtil</span><span class="token scope" style="color:#999">::</span><span class="token" style="color:#DD4A68">isEmpty</span><span class="token" style="color:#999">(</span><span class="token" style="color:#e90">$userId</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">throw</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">MissingMandatoryParameter</span><span class="token" style="color:#999">(</span><span class="token double-quoted-string" style="color:#690">&quot;user.userId&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#e90">$users</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token scope">User</span><span class="token scope" style="color:#999">::</span><span class="token" style="color:#DD4A68">getUsersByUserId</span><span class="token" style="color:#999">(</span><span class="token" style="color:#e90">$userId</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#07a">if</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">sizeof</span><span class="token" style="color:#999">(</span><span class="token" style="color:#e90">$users</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span> </span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:#e90">$response</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#DD4A68">setJsonContent</span><span class="token" style="color:#999">(</span><span>
</span><span>                </span><span class="token" style="color:#999">[</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;resultCode&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token scope">ResultCode</span><span class="token scope" style="color:#999">::</span><span class="token" style="color:#905">NO_ERROR</span><span class="token" style="color:#999">,</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;resultMessage&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token single-quoted-string" style="color:#690">&#x27;&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;exist&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#905">true</span><span>
</span><span>                </span><span class="token" style="color:#999">]</span><span>
</span><span>            </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#e90">$response</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">else</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:#e90">$response</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-&gt;</span><span class="token" style="color:#DD4A68">setJsonContent</span><span class="token" style="color:#999">(</span><span>
</span><span>                </span><span class="token" style="color:#999">[</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;resultCode&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token scope">ResultCode</span><span class="token scope" style="color:#999">::</span><span class="token" style="color:#905">NO_ERROR</span><span class="token" style="color:#999">,</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;resultMessage&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token single-quoted-string" style="color:#690">&#x27;&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>                    </span><span class="token single-quoted-string" style="color:#690">&#x27;exist&#x27;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=&gt;</span><span> </span><span class="token" style="color:#905">false</span><span>
</span><span>                </span><span class="token" style="color:#999">]</span><span>
</span><span>            </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#e90">$response</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>ì´ë¯¸ ì¶©ë¶„íˆ ë°˜ë³µì´ ë ë§Œí•œ ë™ì‘ë“¤ì€ ë©”ì„œë“œë¡œ ë¹ ì ¸ìˆëŠ” ìƒíƒœì´ë©°, ë§¤ìš° ì½ê¸° ì¢‹ì€ ìƒíƒœì˜ ì½”ë“œì˜€ìŠµë‹ˆë‹¤. ì´ ì •ë„ì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì˜®ê²¨ ì“°ë”ë¼ë„
ë¬¸ì œë  ê²ƒ í•˜ë‚˜ ì—†ì–´ ë³´ì…ë‹ˆë‹¤.</p>
<p>í•˜ì§€ë§Œ ì•ì„œ ë§ì”€ë“œë¦°ëŒ€ë¡œ <strong>í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</strong>ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ <strong>ê²€ì¦ ë¡œì§</strong>ë“¤ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ìŠ¤ì½”í”„ ì•ˆì—ì„œ
ì½íˆì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.</p>
<h3>AOP</h3>
<p>ì²˜ìŒ ì œì‹œí•œ ë°©ì•ˆì€ ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•ì´ì—ˆìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="-opacity:.7">java</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">lang</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">annotation</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="color:#DD4A68">ElementType</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="-opacity:.7">java</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">lang</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">annotation</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="color:#DD4A68">Retention</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="-opacity:.7">java</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">lang</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">annotation</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="color:#DD4A68">RetentionPolicy</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="-opacity:.7">java</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">lang</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="-opacity:.7">annotation</span><span class="token" style="-opacity:.7;color:#999">.</span><span class="token" style="color:#DD4A68">Target</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token annotation" style="color:#999">@Target</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span class="token" style="color:#DD4A68">ElementType</span><span class="token" style="color:#999">.</span><span>TYPE</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">ElementType</span><span class="token" style="color:#999">.</span><span>METHOD</span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Retention</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">RetentionPolicy</span><span class="token" style="color:#999">.</span><span>RUNTIME</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token annotation" style="color:#999">@interface</span><span> </span><span class="token" style="color:#DD4A68">CheckClient</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span></code></div></pre>
<p>ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ì„ ìƒì„±í•˜ê³ ,</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Aspect</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Component</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">CheckClientAop</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">BaseAop</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Pointcut</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;@annotation(....annotation.CheckClient)&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">enableCheckClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Before</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;enableCheckClient()&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">checkClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">JoinPoint</span><span> joinPoint</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:slategray">//... client ê²€ì¦ ë¡œì§</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p><code class="jsx-4eaf6378c4a9ee0a ">@CheckClient</code> ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë ¤ ìˆëŠ” í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— Client ê²€ì¦ì„ í•˜ë„ë¡ ì½”ë“œë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/user&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Autowired</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">UserService</span><span> userService</span><span class="token" style="color:#999">;</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@CheckClient</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@GetMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/exist&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">boolean</span><span> </span><span class="token" style="color:#DD4A68">createUser</span><span class="token" style="color:#999">(</span><span>
</span><span>        </span><span class="token annotation" style="color:#999">@RequestBody</span><span> </span><span class="token" style="color:#DD4A68">UserExistReq</span><span> body
</span><span>    </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">String</span><span> userId </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> body</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getUserId</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">User</span><span> user </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> userService</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getUserByUserId</span><span class="token" style="color:#999">(</span><span>userId</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> user </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>í•˜ì§€ë§Œ ìœ„ ê²€ì¦ ë¡œì§ì€ í›„ìˆ í•  ì´ìœ ë¡œ ë“œëë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ Aspect ë©”ì„œë“œëŠ” ë¡œê¹… ë° exception ì²˜ë¦¬ì— ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
<p>ì•„ë˜ëŠ” ë¡œê¹…ì„ ìœ„í•´ Aspect ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ì˜ˆì‹œì…ë‹ˆë‹¤. ìƒì„¸ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Aspect</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Component</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">GlobalAspect</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Order</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Around</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;within(controller..*)&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">Object</span><span> </span><span class="token" style="color:#DD4A68">controllerAspectProcessor</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">ProceedingJoinPoint</span><span> joinPoint</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">HttpServletReqeust</span><span> request </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">ServletRequestAttributes</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#DD4A68">RequestContextHolder</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">currentRequestAttributes</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getRequest</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">StopWatch</span><span> watch </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">StopWatch</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">try</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            watch</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">start</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            joinPoint</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">proceed</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">catch</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Exception</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:slategray">// handle exception</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">finally</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            watch</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">stop</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:slategray">// log - request, watch.getTotalTimeMillis() ë“±...</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<h3>ê²€ì¦ AOP ë¥¼ ë“œëí•œ ì´ìœ </h3>
<p>&#x27;ê²€ì¦&#x27;ì„ ë§ˆì¹œ í›„ì—ëŠ” ìš”ì²­ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Request body ì— client ì •ë³´ (id, secret)ì„ ëª…ì‹œí–ˆë‹¤ë©´
client ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–»ì„ ìˆ˜ ìˆê³ , Authorization í† í°ì„ ê°€ì§€ê³  ë“¤ì–´ì™”ë‹¤ë©´ ê²€ì¦ ê³¼ì •ì—ì„œ íŒŒì‹±í•˜ì—¬
ìœ ì € ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì •ë³´ëŠ” ì‹¤ì œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë“œë¬¼ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<p>í•˜ì§€ë§Œ Aspect ë©”ì„œë“œë¥¼ í†µí•´ ê²€ì¦ì„ ì§„í–‰í•˜ì˜€ë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ í˜¹ì€ ìœ ì € ì •ë³´ë¥¼ ë‹¤ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì´ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.
ì•„ë˜ëŠ” ì´ˆê¸°ì— Aspect ë©”ì„œë“œì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ ì‹¤ì œë¡œ ì´ˆê¸°ì— ì œê°€ êµ¬ì„±í–ˆë˜ êµ¬ì¡°ì…ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">ThreadConst</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">static</span><span> </span><span class="token" style="color:#DD4A68">ThreadLocal</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">Client</span><span class="token generics" style="color:#999">&gt;</span><span> client </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">ThreadLocal</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#999">&gt;</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Aspect</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Component</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">CheckClientAop</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">BaseAop</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Autowired</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">ClientService</span><span> clientService</span><span class="token" style="color:#999">;</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Pointcut</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;@annotation(....annotation.CheckClient)&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">enableCheckClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Before</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;enableCheckClient()&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">checkClient</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">JoinPoint</span><span> joinPoint</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">Client</span><span> client </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> clientService</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">checkClientValid</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">ThreadConst</span><span class="token" style="color:#999">.</span><span>client</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">set</span><span class="token" style="color:#999">(</span><span>client</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/user&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@PostMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">createUser</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">System</span><span class="token" style="color:#999">.</span><span>out</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">println</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;ìƒˆë¡œìš´ ìœ ì €ë¥¼ ìƒì„±í•  ê±°ì—ìš”!&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>      
<span>        </span><span class="token" style="color:#DD4A68">Client</span><span> client </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">ThreadConst</span><span class="token" style="color:#999">.</span><span>client</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p><code class="jsx-4eaf6378c4a9ee0a ">ThreadConst</code> ë¼ëŠ” ìŠ¤ë ˆë“œ ë¡œì»¬ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¶„ë¦¬ ì½”ë“œì—ì„œ ìŠ¤ë ˆë“œ ë¡œì»¬ì— ì €ì¥í•˜ê³  ì‹¤ì œ í•¸ë“¤ëŸ¬ì—ì„œ êº¼ë‚´ì“°ëŠ”
ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. ë™ì‘ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ” ì½”ë“œì´ì§€ë§Œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ ì² ì €íˆ í•´ì•¼ í•œë‹¤ëŠ” ì , ì˜ë„í•œ ì‘ë™ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì  ë“±
ì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì˜€ì„ ë•Œì˜ ë¬¸ì œì ë“¤ì„ ì´ìœ ë¡œ ì§€ì ë°›ì•˜ìŠµë‹ˆë‹¤.</p>
<p>ì´ë¥¼ êµ¬í˜„í•˜ëŠ” ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ <strong>Resolver</strong> ë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<h3>HandlerMethodArgumentResolver</h3>
<p>ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ì¸ìê°’ë“¤ì˜ ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ ë©”ì„œë“œì— íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì„
ë¶™í˜€ì„œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë°”ì¸ë”©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<p><code class="jsx-4eaf6378c4a9ee0a ">Header: Authorization</code> ì— Bearer í† í° ê°’ì„ ê²€ì¦í•˜ê³  í•„ìš”í•œ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ë„˜ê²¨ì£¼ëŠ”
ì‹¤ì œ ì½”ë“œë¥¼ ê°„ë‹¨íˆ ìš”ì•½í•œ ê²ƒì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// ë°”ì¸ë”© ë§¤ê°œì²´ë¡œ ì‚¬ìš©í•  ì–´ë…¸í…Œì´ì…˜</span><span>
</span>
<span></span><span class="token annotation" style="color:#999">@Target</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span class="token" style="color:#DD4A68">ElementType</span><span class="token" style="color:#999">.</span><span>PARAMETER</span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Retention</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">RetentionPolicy</span><span class="token" style="color:#999">.</span><span>RUNTIME</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token annotation" style="color:#999">@interface</span><span> </span><span class="token" style="color:#DD4A68">AuthToken</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">boolean</span><span> </span><span class="token" style="color:#DD4A68">required</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">default</span><span> </span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// Resolver ì •ì˜</span><span>
</span>
<span></span><span class="token annotation" style="color:#999">@Component</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequiredArgsConstructor</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">AuthTokenArgumentResolver</span><span> </span><span class="token" style="color:#07a">implements</span><span> </span><span class="token" style="color:#DD4A68">HandlerMethodArgumentResolver</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Autowired</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">TokenParser</span><span> parser</span><span class="token" style="color:#999">;</span><span>
</span>  
<span>    </span><span class="token" style="color:slategray">// ì´ ë©”ì„œë“œì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„°ì¸ì§€ë¥¼ íŒë‹¨</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Override</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">boolean</span><span> </span><span class="token" style="color:#DD4A68">supportsParameter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">MethodParameter</span><span> parameter</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> parameter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getParameterAnnotation</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">AuthToken</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:slategray">// supportsParameter ì—ì„œ AuthToken ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦° ì¸ìë¥¼ í™•ì¸í•˜ê³  Header ì˜ í† í°ê°’ì„ íŒŒì‹±í•˜ì—¬ í•´ë‹¹ ì¸ìì— ë°”ì¸ë”©.</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Override</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">Object</span><span> </span><span class="token" style="color:#DD4A68">resolveArgument</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">MethodParameter</span><span> parameter</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">ModelAndViewContainer</span><span> mavContainer</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">NativeWebRequest</span><span> webRequest</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">WebDataBinderFactory</span><span> binderFactory</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">throws</span><span> </span><span class="token" style="color:#DD4A68">Exception</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">String</span><span> authHeader </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> webRequest</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getHeader</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;Authorization&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span class="token" style="color:#999">(</span><span>authHeader </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> authHeader </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> authHeader</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">trim</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> parser</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">parse</span><span class="token" style="color:#999">(</span><span>authHeader</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/user&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@PostMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">createUser</span><span class="token" style="color:#999">(</span><span>
</span><span>        </span><span class="token annotation" style="color:#999">@AuthToken</span><span> </span><span class="token" style="color:#DD4A68">Object</span><span> token  </span><span class="token" style="color:slategray">// ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ì„œ íŒŒì‹±ë˜ì–´ í™œìš© ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ì•„ ì‚¬ìš©</span><span>
</span><span>    </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">String</span><span> name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> token</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getUserName</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ &#x27;ê²€ì¦&#x27;ì— í•„ìš”í•œ ì½”ë“œë“¤ì„ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<hr/>
<h2>ë°ì´í„°ë² ì´ìŠ¤</h2>
<h3>JPA</h3>
<p>ìš”êµ¬ ì‚¬í•­ íŠ¹ì§• ìƒ ë³µì¡í•˜ê±°ë‚˜ ë™ì ì¸ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ê³  ë˜í•œ ë°ì´í„° ìì²´ê°€ ê°ì²´ë¡œì¨ íŠ¹ì •í• ë§Œí•œ ì—­í• ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—
<code class="jsx-4eaf6378c4a9ee0a ">mybatis</code> ë“±ê³¼ ê°™ì€ ORM ê°œë…ì´ ì—†ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë”ë¼ë„ ë¬¸ì œë  ê²ƒì€ ì—†ì—ˆìŠµë‹ˆë‹¤ë§Œ,
ê°œë°œìì˜ <strong>ê°œë°œ í¸ì˜ì„±</strong>ê³¼ ì´ ì—­ì‹œ <strong>í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</strong>ì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ JPA ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>ê°€ì¥ ë¬´ë‚œí•œ <code class="jsx-4eaf6378c4a9ee0a ">Hibernate</code> ORM í”„ë ˆì„ì›Œí¬ë¥¼ ì±„íƒí•˜ì˜€ìœ¼ë©° <code class="jsx-4eaf6378c4a9ee0a ">JPQL</code> ë¡œ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
<h3>Replication</h3>
<p>Read-only ë©”ì„œë“œê°€ ì••ë„ì ìœ¼ë¡œ ë§ì€ ì„œë¹„ìŠ¤ íŠ¹ì„± ìƒ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” Master-Slave êµ¬ì¡°ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆê³  Slave ë°ì´í„°ë² ì´ìŠ¤ê°€
Read íŠ¸ëœì­ì…˜ì„ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•´ì„œ Replication ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">MasterDataSourceConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Primary</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;masterDataSource&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ConfigurationProperties</span><span class="token" style="color:#999">(</span><span>prefix </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;spring.datasource.master.hikari&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> </span><span class="token" style="color:#DD4A68">masterDataSource</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">DataSourceBuilder</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">create</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">type</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HikariDataSource</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">SlaveDataSourceConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;slaveDataSource&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ConfigurationProperties</span><span class="token" style="color:#999">(</span><span>prefix </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;spring.datasource.slave.hikari&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> </span><span class="token" style="color:#DD4A68">slaveDataSource</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">DataSourceBuilder</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">create</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">type</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HikariDataSource</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">build</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>Master ì„¤ì •ê³¼ Slave ì„¤ì •ì„ ë‚˜ëˆ„ì–´ ê°ì²´ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. Property ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¸ DataSource ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
<p>DataSource ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ê¸° ìœ„í•œ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// Transaction ì„±ê²©ì— ë”°ë¼ ì—°ê²° ìœ í˜•ì„ ê²°ì •í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">ReplicationRoutingDataSource</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">AbstractRoutingDataSource</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Override</span><span>
</span><span>    </span><span class="token" style="color:#07a">protected</span><span> </span><span class="token" style="color:#DD4A68">Object</span><span> </span><span class="token" style="color:#DD4A68">determineCurrentLookupKey</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">TransactionSynchronizationManager</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">isCurrentTransactionReadOnly</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">?</span><span> </span><span class="token" style="color:#DD4A68">DataSourceType</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Slave</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#DD4A68">DataSourceType</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Master</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">RoutingDataSourceConfig</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token" style="color:slategray">// Map ìƒì„±</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;routingDataSource&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> </span><span class="token" style="color:#DD4A68">routingDataSource</span><span class="token" style="color:#999">(</span><span>
</span><span>        </span><span class="token annotation" style="color:#999">@Qualifier</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;masterDataSource&quot;</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> masterDataSource</span><span class="token" style="color:#999">,</span><span>
</span><span>        </span><span class="token annotation" style="color:#999">@Qualifier</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;slaveDataSource&quot;</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">final</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> slaveDataSource
</span><span>    </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">ReplicationRoutingDataSource</span><span> routingDataSource </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">ReplicationRoutingDataSource</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">Map</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">Object</span><span class="token generics" style="color:#999">,</span><span class="token generics"> </span><span class="token generics" style="color:#DD4A68">Object</span><span class="token generics" style="color:#999">&gt;</span><span> dataSourceMap </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">HashMap</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#999">&gt;</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        dataSourceMap</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">put</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">DataSourceType</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Master</span><span class="token" style="color:#999">,</span><span> masterDataSource</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span class="token" style="color:#999">(</span><span>useRdbSlave</span><span class="token" style="color:#999">)</span><span> dataSourceMap</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">put</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">DataSourceType</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">Slave</span><span class="token" style="color:#999">,</span><span> slaveDataSource</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        routingDataSource</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setTargetDataSources</span><span class="token" style="color:#999">(</span><span>dataSourceMap</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        routingDataSource</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setDefaultTargetDataSource</span><span class="token" style="color:#999">(</span><span>masterDataSource</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> routingDataSource</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:slategray">// íŠ¸ëœì ì…˜ì´ ìƒì„±ë  ë•Œê°€ ì•„ë‹ˆë¼ ì‹¤ì œ ì¿¼ë¦¬ê°€ ë°œìƒí•  ë•Œì— connection ì„ ì ìœ í•˜ë„ë¡ ì„¤ì •</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;dataSource&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> </span><span class="token" style="color:#DD4A68">dataSource</span><span class="token" style="color:#999">(</span><span class="token annotation" style="color:#999">@Qualifier</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;routingDataSource&quot;</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> routingDataSource</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">LazyConnectionDataSourceProxy</span><span class="token" style="color:#999">(</span><span>routingDataSource</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:slategray">// EntityManagerFactory ì„¤ì •</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;jpaEntityManagerFactory&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">LocalContainerEntityManagerFactoryBean</span><span> </span><span class="token" style="color:#DD4A68">entityManagerFactory</span><span class="token" style="color:#999">(</span><span class="token annotation" style="color:#999">@Qualifier</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;dataSource&quot;</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#DD4A68">DataSource</span><span> dataSource</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">Map</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">String</span><span class="token generics" style="color:#999">,</span><span class="token generics"> </span><span class="token generics" style="color:#DD4A68">Object</span><span class="token generics" style="color:#999">&gt;</span><span> prop </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">HashMap</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#999">&gt;</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        prop</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">put</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;hibernate.physical_naming_strategy&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">SpringPhysicalNamingStrategy</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getName</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        prop</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">put</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;hibernate.implicit_naming_strategy&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">SpringImplicitNamingStrategy</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getName</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        prop</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">put</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;hibernate.hbm2ddl.auto&quot;</span><span class="token" style="color:#999">,</span><span> env</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getProperty</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;spring.jpa.hibernate.ddl-auto&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#DD4A68">LocalContainerEntityManagerFactoryBean</span><span> em </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">LocalContainerEntityManagerFactoryBean</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        em</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setJpaVendorAdapter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">HibernateJpaVendorAdapter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        em</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setDataSource</span><span class="token" style="color:#999">(</span><span>dataSource</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        em</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setPackagesToScan</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;common.jpa.entity&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;gauth.jpa.entity&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        em</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setPersistenceUnitName</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;jpaEntityManager&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        em</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setJpaPropertyMap</span><span class="token" style="color:#999">(</span><span>prop</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> em</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:slategray">// JpaTransactionManager êµ¬í˜„ ë° bean ìœ¼ë¡œ ë“±ë¡</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Bean</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;jpaTransactionManager&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">PlatformTransactionManager</span><span> </span><span class="token" style="color:#DD4A68">jpaTransactionManager</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">EntityManagerFactory</span><span> entityManagerFactory</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">JpaTransactionManager</span><span> transactionManager </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">JpaTransactionManager</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        transactionManager</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setEntityManagerFactory</span><span class="token" style="color:#999">(</span><span>entityManagerFactory</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> transactionManager</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>ì„¤ì •ì„ ë§ˆì³¤ìœ¼ë‹ˆ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ë³„ë¡œ íŠ¸ëœì ì…˜ì˜ ì„±ê²©ì„ ì •í•´ì£¼ì–´ ì˜¬ë°”ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¼ìš°íŒ…ë˜ë„ë¡ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/user&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Transactional</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@PostMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">createUser</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:slategray">// ...</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Transactional</span><span class="token" style="color:#999">(</span><span>readOnly </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@GetMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">getUserInfo</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:slategray">// ...</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<h2>Exception</h2>
<p>ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë²”ìœ„ì˜ exception ë“¤ì€ ì»¤ìŠ¤í…€í•œ <code class="jsx-4eaf6378c4a9ee0a ">RuntimeException</code> ì„ ë˜ì ¸ AOP ì—ì„œ ì•Œë§ëŠ” Response body ìƒì„±í•˜ì—¬
ì‘ë‹µí•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">BaseException</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">RuntimeException</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> code </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;9999&quot;</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> message </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;&quot;</span><span class="token" style="color:#999">;</span><span>
</span>  
<span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span> code</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> message</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">super</span><span class="token" style="color:#999">(</span><span>message</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">this</span><span class="token" style="color:#999">.</span><span>code </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> code</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">this</span><span class="token" style="color:#999">.</span><span>message </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> message</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/user&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">UserController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@GetMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&#x27;/&#x27;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">getUserInfo</span><span class="token" style="color:#999">(</span><span>
</span><span>        </span><span class="token annotation" style="color:#999">@RequestBody</span><span> </span><span class="token" style="color:#DD4A68">UserReq</span><span> body
</span><span>    </span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:slategray">// ...</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">User</span><span> user </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> userService</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getUserById</span><span class="token" style="color:#999">(</span><span>body</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getUserId</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>user </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">==</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">throw</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">400</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;User ID is not found&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">static</span><span> </span><span class="token" style="color:#DD4A68">ResponseEntity</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">BaseResponse</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Exception</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>e </span><span class="token" style="color:#07a">instanceof</span><span> </span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            code </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> e</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span>code</span><span class="token" style="color:#999">;</span><span>
</span><span>            message </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> e</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span>message</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">BaseResponse</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toResponseEntity</span><span class="token" style="color:#999">(</span><span>code</span><span class="token" style="color:#999">,</span><span> message</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@Aspect</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Component</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">GlobalAspect</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>  
<span>    </span><span class="token annotation" style="color:#999">@Order</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Around</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;within(controller..*)&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">Object</span><span> </span><span class="token" style="color:#DD4A68">controllerAspect</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">ProceedingJoinPoint</span><span> joinPoint</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">Object</span><span> returnObject </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">try</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            returnObject </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> joinPoint</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">proceed</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">catch</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Exception</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            returnObject </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span>e</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span>      
<span>        </span><span class="token" style="color:#07a">return</span><span> returnObject</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>Exception ì´ ë°œìƒí•˜ë”ë¼ë„ ì›í•˜ëŠ” í˜•íƒœì˜ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<p>ë˜í•œ í”„ë ˆì„ì›Œí¬ì—ì„œ ë°œìƒì‹œí‚¤ëŠ” exception ë“¤ì˜ ê²½ìš°ë„ ì»¤ìŠ¤í…€í•œ exception ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ìˆì—ˆê¸° ë•Œë¬¸ì— <code class="jsx-4eaf6378c4a9ee0a ">@ControllerAdvice</code> ê°ì²´ë¥¼ í†µí•´ ì²˜ë¦¬í•˜ë„ë¡ ì¶”ê°€ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token annotation" style="color:#999">@ControllerAdvice</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">static</span><span> </span><span class="token" style="color:#DD4A68">ResponseEntity</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">BaseResponse</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Exception</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>e </span><span class="token" style="color:#07a">instanceof</span><span> </span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            code </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> e</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span>code</span><span class="token" style="color:#999">;</span><span>
</span><span>            message </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">BaseException</span><span class="token" style="color:#999">)</span><span> e</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span>message</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">BaseResponse</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toResponseEntity</span><span class="token" style="color:#999">(</span><span>code</span><span class="token" style="color:#999">,</span><span> message</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>  
<span>    </span><span class="token doc-comment" style="color:slategray">/** 
</span><span class="token doc-comment" style="color:slategray">     * RequestBody ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì„ì—ë„ ë¶ˆêµ¬í•˜ê³  JSON body ê°€ ì—†ëŠ” ê²½ìš°
</span><span class="token doc-comment" style="color:slategray">     */</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ExceptionHandler</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpMessageNotReadableException</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseStatus</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpStatus</span><span class="token" style="color:#999">.</span><span>BAD_REQUEST</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseBody</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">ResponseEntity</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">BaseResponseDto</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpServletRequest</span><span> req</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">HttpMessageNotReadableException</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">ParamVerifyException</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;Something is wrong with request body: &quot;</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> e</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getMessage</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token doc-comment" style="color:slategray">/**
</span><span class="token doc-comment" style="color:slategray">     * RequestHeader ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ í—¤ë”ê°€ ë¹„ì–´ ìˆëŠ” ê²½ìš°
</span><span class="token doc-comment" style="color:slategray">     */</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ExceptionHandler</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">MissingRequestHeaderException</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseStatus</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpStatus</span><span class="token" style="color:#999">.</span><span>OK</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseBody</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">ResponseEntity</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">BaseResponseDto</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpServletRequest</span><span> req</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">MissingRequestHeaderException</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">MissingMandatoryHeaderException</span><span class="token" style="color:#999">(</span><span>e</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getMessage</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token doc-comment" style="color:slategray">/**
</span><span class="token doc-comment" style="color:slategray">     * RequestParam ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ëœ ê²½ìš°
</span><span class="token doc-comment" style="color:slategray">     */</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ExceptionHandler</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">MissingServletRequestParameterException</span><span class="token" style="color:#999">.</span><span class="token" style="color:#07a">class</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseStatus</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpStatus</span><span class="token" style="color:#999">.</span><span>OK</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@ResponseBody</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">ResponseEntity</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">BaseResponseDto</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">HttpServletRequest</span><span> req</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">MissingServletRequestParameterException</span><span> e</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">GlobalExceptionHandler</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">handle</span><span class="token" style="color:#999">(</span><span>req</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">ParamVerifyException</span><span class="token" style="color:#999">(</span><span>e</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">getMessage</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë°œìƒ ê°€ëŠ¥í•œ Exception ì„ ìµœëŒ€í•œ ê³ ë ¤í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‹ë³„ ê°€ëŠ¥í•œ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<h2>ë¹Œë“œì™€ ë°°í¬</h2>
<p>Docker ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ êµ¬ë™í•˜ëŠ” ê¸°ì¡´ ë‹¤ë¥¸ ì„œë²„ì™€ ë™ì¼í•˜ê²Œ ë°°í¬ ë°©ì‹ì„ ê°€ì ¸ê°€ì•¼ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ”
ì•„ë˜ì™€ ê°™ì€ ì ë“¤ì„ ê³ ë ¤í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.</p>
<ol>
<li>AWS ECS cluster ì— ì„œë¹„ìŠ¤ê°€ ë“±ë¡ë  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— SSH ì ‘ì†ì„ ìœ„í•œ ì¡°ì¹˜ê°€ í•„ìš”</li>
<li>ELK êµ¬ì¡°ë¥¼ í†µí•´ ë¡œê·¸ë¥¼ AWS OpenSearch ì„œë¹„ìŠ¤ì— ì ì¬í•˜ë¯€ë¡œ filebeat ì„¤ì •ì´ í•„ìš”</li>
<li>develop, stage, production ìœ¼ë¡œ 3ê°€ì§€ í™˜ê²½ì´ ë‚˜ëˆ„ì–´ì§€ë¯€ë¡œ ì¶”ê°€ ì„¤ì •ì´ í•„ìš”</li>
</ol>
<p>ë„ì»¤íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì‹¤ì œ ì½”ë“œë¥¼ ìƒëµí•˜ê³  ë™ì‘ ìˆœì„œë¥¼ ê°„ë‹¨íˆ ì„¤ëª…í•©ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-dockerfile" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray"># alpine ë¦¬ëˆ…ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</span><span>
</span><span></span><span class="token instruction" style="color:#07a">FROM</span><span class="token instruction"> alpine:3.15  </span><span>
</span><span></span><span class="token" style="color:slategray"># openjdk11-jre logrotate openssh filebeat ì„¤ì¹˜</span><span>
</span><span></span><span class="token" style="color:slategray"># project ë‚´ key file ì„ ADD í•˜ê³  ê¶Œí•œ ë¶€ì—¬</span><span>
</span><span></span><span class="token" style="color:slategray"># JAVA_HOME í™˜ê²½ ë³€ìˆ˜ ë“±ë¡</span><span>
</span><span></span><span class="token" style="color:slategray"># project ë‚´ ë°”ì´ë„ˆë¦¬ ì‹¤í–‰ scriptë¥¼ ADD (entrypoint.sh)</span><span>
</span><span></span><span class="token" style="color:slategray"># project ë‚´ filebeat ì„¤ì • íŒŒì¼ì„ ADD í•˜ê³  í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬</span><span>
</span><span></span><span class="token" style="color:slategray"># build ë˜ì–´ ìˆëŠ” jar íŒŒì¼ì„ ADD</span><span>
</span><span></span><span class="token instruction" style="color:#07a">ENTRYPOINT</span><span class="token instruction"> /root/entrypoint.sh</span></code></div></pre>
<p>ë°°í¬ëŠ” git commit push ì‹œ pipeline ì´ ë™ì‘í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŒ€ ë‚´ í˜•ìƒ ê´€ë¦¬ëŠ” gitlab ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°
gitlab ì˜ CI/CD ëŠ” pipeline ìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì‹¤ì œ pipeline ì½”ë“œì—ì„œ í•µì‹¬ ì½”ë“œë§Œ ê°„ì¶”ë¦° ì˜ˆì‹œì…ë‹ˆë‹¤.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-yml" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token key" style="color:#07a">stages</span><span class="token" style="color:#999">:</span><span>
</span><span>  </span><span class="token" style="color:#999">-</span><span> versioning
</span><span>  </span><span class="token" style="color:#999">-</span><span> build
</span><span>  </span><span class="token" style="color:#999">-</span><span> deploy
</span>
<span></span><span class="token key" style="color:#07a">versioning-job</span><span class="token" style="color:#999">:</span><span>
</span><span>  </span><span class="token key" style="color:#07a">stage</span><span class="token" style="color:#999">:</span><span> versioning
</span><span>  </span><span class="token key" style="color:#07a">script</span><span class="token" style="color:#999">:</span><span>
</span><span>    </span><span class="token" style="color:#999">-</span><span> CURR_VER=$(cat build.gradle </span><span class="token" style="color:#999">|</span><span> grep &quot;version =&quot; </span><span class="token" style="color:#999">|</span><span> sed </span><span class="token" style="color:#999">-</span><span>E &#x27;s/version = &quot;(.</span><span class="token" style="color:#e90;font-weight:bold">*)&quot;$/\1/&#x27;)</span><span>
</span>
<span></span><span class="token key" style="color:#07a">build-job</span><span class="token" style="color:#999">:</span><span>
</span><span>  </span><span class="token key" style="color:#07a">stage</span><span class="token" style="color:#999">:</span><span> build
</span><span>  </span><span class="token key" style="color:#07a">script</span><span class="token" style="color:#999">:</span><span>
</span><span>    </span><span class="token" style="color:#999">-</span><span> ./gradlew build
</span><span>    </span><span class="token" style="color:#999">-</span><span> docker build . </span><span class="token" style="color:#999">-</span><span>t cloud</span><span class="token" style="color:#999">-</span><span>v2</span><span class="token" style="color:#999">-</span><span>gauth
</span>
<span></span><span class="token key" style="color:#07a">deploy-job</span><span class="token" style="color:#999">:</span><span>
</span><span>  </span><span class="token key" style="color:#07a">stage</span><span class="token" style="color:#999">:</span><span> deploy
</span><span>  </span><span class="token key" style="color:#07a">needs</span><span class="token" style="color:#999">:</span><span> </span><span class="token" style="color:#999">[</span><span> </span><span class="token" style="color:#690">&quot;versioning-job&quot;</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">&quot;build-job&quot;</span><span> </span><span class="token" style="color:#999">]</span><span>
</span><span>  </span><span class="token key" style="color:#07a">script</span><span class="token" style="color:#999">:</span><span>
</span><span>    </span><span class="token" style="color:slategray">#   aws-cli ECR login | AWS docker login</span><span>
</span><span>    </span><span class="token" style="color:#999">-</span><span> TAG=&quot;$CI_COMMIT_BRANCH&quot;
</span><span>    </span><span class="token" style="color:#999">-</span><span> </span><span class="token" style="color:#999">&gt;</span><span class="token scalar" style="color:#690">
</span><span class="token scalar" style="color:#690">      if [ &quot;$CI_COMMIT_BRANCH&quot; = &quot;master&quot; ]; then
</span><span class="token scalar" style="color:#690">        TAG=&quot;latest&quot;
</span><span class="token scalar" style="color:#690">      fi</span><span>
</span><span>  </span><span class="token" style="color:slategray">#   ì´ë¯¸ì§€ë¥¼ AWS ECR ì— í‘¸ì‹œ</span><span>
</span><span>  </span><span class="token key" style="color:#07a">dependencies</span><span class="token" style="color:#999">:</span><span>
</span><span>    </span><span class="token" style="color:#999">-</span><span> build</span><span class="token" style="color:#999">-</span><span>job</span></code></div></pre>
<p>ì´ì™€ ê°™ì´ êµ¬ì„±í•˜ì—¬ ì½”ë“œ í‘¸ì‹œê°€ ì¼ì–´ë‚œë‹¤ë©´ AWS ECR ì— ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ê°€ ë˜ê³ , ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ë©´
ì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (ê°œë°œ í™˜ê²½), í´ëŸ¬ìŠ¤í„° ì„œë¹„ìŠ¤ì˜ Task ì— ìƒˆ ë°°í¬ë¥¼ ì ìš©í•˜ì—¬ ì¬ì‹œì‘(ìŠ¤í…Œì´ì§€, ìƒìš© í™˜ê²½)í•˜ëŠ” ê²ƒìœ¼ë¡œ
ì‹ ê·œ ë²„ì „ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•©ë‹ˆë‹¤.</p></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":0,"title":"ì½”ë§¥ìŠ¤ í´ë¼ìš°ë“œ 2.0 ì¸ì¦/ì—°ë™ ì„œë²„","date":"2023-04-14","tag":["Spring Boot","Spring Data JPA","Gitlab Pipeline","Docker","AWS ECS"],"content":"\n- ê¸°ê°„: 2022-04 ~ 2022-08, ì•½ 5ê°œì›”\n- êµ¬ì„± ì¸ì›: 1ì¸\n- ì£¼ìš” ì—…ë¬´\n    - PHP to Java ê¸°ëŠ¥ ë§ˆì´ê·¸ë ˆì´ì…˜.\n    - Spring Boot í”„ë¡œì íŠ¸ êµ¬ì„±\n    - Dockerfile ì‘ì„± (ë¹Œë“œ)\n    - Gitlab pipeline ì½”ë“œ ì‘ì„± (CI/CD ë°°í¬)\n    - AWS ECS Task ì •ì˜ ë° ì„œë¹„ìŠ¤ ìƒì„± (í´ëŸ¬ìŠ¤í„° ì •ì˜)\n- ê²°ê³¼: ì½”ë“œ ì´ê´€ ì™„ë£Œ ë° 22ë…„ 10ì›” ìƒìš© ê¸°ì¡´ ì„œë¹„ìŠ¤ ëŒ€ì²´ ë°°í¬ ì™„ë£Œ.\n- ê°œì„ ì : MSA ë‚´ íƒ€ êµ¬ì¡°ì™€ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ìœ ì§€ ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì  í™•ë³´.\n- ê¸°ìˆ  ìŠ¤íƒ\n    - Spring Boot (Java)\n    - Spring JPA (Hibernate, JPQL)\n    - Gitlab pipeline (CI/CD)\n    - Docker\n    - AWS ECS Cluster\n\n---\n\n# í”„ë¡œì íŠ¸ ì†Œê°œ\n\nMSA ë¡œ êµ¬ì„±ëœ ìì‚¬ ë°±ì—”ë“œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ëŠ” ëŒ€ë¶€ë¶„ì˜ ì„œë²„ ë°”ì´ë„ˆë¦¬ê°€ Java ë¡œ ì‘ì„±ë˜ì–´ ìˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì¸ì¦(Auth), ì—°ë™(Group) ì„œë²„ëŠ”\nPHP ì½”ë“œë¡œ ì‘ì„±ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ MSA ë‚´ íƒ€ ì„œë²„ë“¤ê³¼ ë™ì¼í•œ ì–¸ì–´ ìŠ¤í™ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì´ ì£¼ ëª©ì ì¸ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.\n\nê¸°ì¡´ ì½”ë“œê°€ ì¡´ì¬í•˜ê¸´ í•˜ë‚˜ ì‹ ê·œ í”„ë¡œì íŠ¸ë‚˜ ë‹¤ë¦„ ì—†ì—ˆìŠµë‹ˆë‹¤. ì¢‹ì€ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•˜ì—¬ ì–´ë–¤ ì ì„ ê³ ë ¤í•˜ê³  ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ì˜€ëŠ”ì§€\nê°„ë‹¨íˆ ì†Œê°œí•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n\n---\n\n## í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì™€ì˜ ì½”ë“œ ë¶„ë¦¬\n\nì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ëŠ” ìµœëŒ€í•œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì½”ë“œë“¤ì€ ëª¨ë‘ ë¶„ë¦¬í•˜ëŠ” ê²ƒì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤.\nì—¬ê¸°ì„œ ë‚˜ë¨¸ì§€ ì½”ë“œë¼ í•¨ì€ ê°€ì¥ ë¨¼ì € 'ë¡œê¹…', 'ê²€ì¦'ê³¼ ê°™ì€ ë¡œì§ë“¤ì´ ìƒê°ì´ ë‚©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ë³„ë„ êµ¬í˜„í•œë‹¤ë©´\nê°€ë…ì„± í–¥ìƒë˜ì–´ ìœ ì§€ ë³´ìˆ˜ ìš©ì´ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆê³  ì´ í›„ í˜‘ì—…ì„ í•¨ì— ìˆì–´ íƒ€ì¸ì—ê²Œ ì½”ë“œë¥¼ ì´í•´ì‹œí‚¤ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì„ ì–»ì„ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.\n\nì•„ë˜ëŠ” ì‹¤ì œ ê¸°ì¡´ ì¸ì¦ ì„œë²„ ë‚´ ìœ ì € ì•„ì´ë””ê°€ ì¡´ì¬í•˜ëŠ” ì§€ ê²€ì‚¬í•˜ëŠ” ë©”ì„œë“œì˜ PHP ì½”ë“œë¥¼ ì¼ë¶€ ìƒëµí•œ ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```php\nclass UserController extends BaseController {\n\n    public function userExistAction() {\n  \n        $this-\u003eview-\u003edisable();\n        $response = new Response();\n      \n        $rawBody = $this-\u003erequest-\u003egetJsonRawBody(true);\n      \n        $client = CmxCommon::checkClientOrThrow($rawBody);\n      \n        $userId = $rawBody['user']['userId'];\n        if (StringUtil::isEmpty($userId)) throw new MissingMandatoryParameter(\"user.userId\");\n      \n        $users = User::getUsersByUserId($userId);\n      \n        if(sizeof($users) \u003e 0) {\n            $response-\u003esetJsonContent(\n                [\n                    'resultCode' =\u003e ResultCode::NO_ERROR,\n                    'resultMessage' =\u003e '',\n                    'exist' =\u003e true\n                ]\n            );\n            return $response;\n        } else {\n            $response-\u003esetJsonContent(\n                [\n                    'resultCode' =\u003e ResultCode::NO_ERROR,\n                    'resultMessage' =\u003e '',\n                    'exist' =\u003e false\n                ]\n            );\n        }\n\n        return $response;\n    }\n}\n```\n\nì´ë¯¸ ì¶©ë¶„íˆ ë°˜ë³µì´ ë ë§Œí•œ ë™ì‘ë“¤ì€ ë©”ì„œë“œë¡œ ë¹ ì ¸ìˆëŠ” ìƒíƒœì´ë©°, ë§¤ìš° ì½ê¸° ì¢‹ì€ ìƒíƒœì˜ ì½”ë“œì˜€ìŠµë‹ˆë‹¤. ì´ ì •ë„ì˜ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì˜®ê²¨ ì“°ë”ë¼ë„\në¬¸ì œë  ê²ƒ í•˜ë‚˜ ì—†ì–´ ë³´ì…ë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ ì•ì„œ ë§ì”€ë“œë¦°ëŒ€ë¡œ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ë§Œì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ **ê²€ì¦ ë¡œì§**ë“¤ì€ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ìŠ¤ì½”í”„ ì•ˆì—ì„œ\nì½íˆì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.\n\n### AOP\n\nì²˜ìŒ ì œì‹œí•œ ë°©ì•ˆì€ ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°ìœ¼ë¡œ ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ëŠ” ë°©ë²•ì´ì—ˆìŠµë‹ˆë‹¤.\n\n```java\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface CheckClient {}\n```\n\nì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ì„ ìƒì„±í•˜ê³ ,\n\n```java\n@Aspect\n@Component\npublic class CheckClientAop extends BaseAop {\n    @Pointcut(\"@annotation(....annotation.CheckClient)\")\n    private void enableCheckClient() {}\n  \n    @Before(\"enableCheckClient()\")\n    public void checkClient(JoinPoint joinPoint) {\n        //... client ê²€ì¦ ë¡œì§\n    }\n}\n```\n\n`@CheckClient` ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë ¤ ìˆëŠ” í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— Client ê²€ì¦ì„ í•˜ë„ë¡ ì½”ë“œë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @Autowired\n    private UserService userService;\n  \n    @CheckClient\n    @GetMapping('/exist')\n    public boolean createUser(\n        @RequestBody UserExistReq body\n    ) {\n        String userId = body.getUserId();\n        User user = userService.getUserByUserId(userId);\n        return user != null;\n    }\n}\n```\n\ní•˜ì§€ë§Œ ìœ„ ê²€ì¦ ë¡œì§ì€ í›„ìˆ í•  ì´ìœ ë¡œ ë“œëë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ Aspect ë©”ì„œë“œëŠ” ë¡œê¹… ë° exception ì²˜ë¦¬ì— ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.\n\nì•„ë˜ëŠ” ë¡œê¹…ì„ ìœ„í•´ Aspect ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œ ì˜ˆì‹œì…ë‹ˆë‹¤. ìƒì„¸ ì½”ë“œëŠ” ìƒëµí•©ë‹ˆë‹¤.\n\n```java\n@Aspect\n@Component\npublic class GlobalAspect {\n    @Order(0)\n    @Around(\"within(controller..*)\")\n    public Object controllerAspectProcessor(ProceedingJoinPoint joinPoint) {\n        HttpServletReqeust request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();\n        StopWatch watch = new StopWatch();\n        try {\n            watch.start();\n            joinPoint.proceed();\n        } catch (Exception e) {\n            // handle exception\n        } finally {\n            watch.stop();\n            // log - request, watch.getTotalTimeMillis() ë“±...\n        }\n    }\n}\n```\n\n### ê²€ì¦ AOP ë¥¼ ë“œëí•œ ì´ìœ \n\n'ê²€ì¦'ì„ ë§ˆì¹œ í›„ì—ëŠ” ìš”ì²­ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Request body ì— client ì •ë³´ (id, secret)ì„ ëª…ì‹œí–ˆë‹¤ë©´\nclient ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì–»ì„ ìˆ˜ ìˆê³ , Authorization í† í°ì„ ê°€ì§€ê³  ë“¤ì–´ì™”ë‹¤ë©´ ê²€ì¦ ê³¼ì •ì—ì„œ íŒŒì‹±í•˜ì—¬\nìœ ì € ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì •ë³´ëŠ” ì‹¤ì œ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë“œë¬¼ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ Aspect ë©”ì„œë“œë¥¼ í†µí•´ ê²€ì¦ì„ ì§„í–‰í•˜ì˜€ë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ í˜¹ì€ ìœ ì € ì •ë³´ë¥¼ ë‹¤ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì´ ì‰½ì§€ ì•ŠìŠµë‹ˆë‹¤.\nì•„ë˜ëŠ” ì´ˆê¸°ì— Aspect ë©”ì„œë“œì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œë¡œ ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ ì‹¤ì œë¡œ ì´ˆê¸°ì— ì œê°€ êµ¬ì„±í–ˆë˜ êµ¬ì¡°ì…ë‹ˆë‹¤.\n\n```java\npublic class ThreadConst {\n    public static ThreadLocal\u003cClient\u003e client = new ThreadLocal\u003c\u003e();\n}\n```\n\n```java\n@Aspect\n@Component\npublic class CheckClientAop extends BaseAop {\n  \n    @Autowired\n    private ClientService clientService;\n  \n    @Pointcut(\"@annotation(....annotation.CheckClient)\")\n    private void enableCheckClient() {}\n  \n    @Before(\"enableCheckClient()\")\n    public void checkClient(JoinPoint joinPoint) {\n        Client client = clientService.checkClientValid();\n        ThreadConst.client.set(client);\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @PostMapping('/')\n    public void createUser() {\n        System.out.println(\"ìƒˆë¡œìš´ ìœ ì €ë¥¼ ìƒì„±í•  ê±°ì—ìš”!\");\n      \n        Client client = ThreadConst.client.get();\n    }\n}\n```\n\n`ThreadConst` ë¼ëŠ” ìŠ¤ë ˆë“œ ë¡œì»¬ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¶„ë¦¬ ì½”ë“œì—ì„œ ìŠ¤ë ˆë“œ ë¡œì»¬ì— ì €ì¥í•˜ê³  ì‹¤ì œ í•¸ë“¤ëŸ¬ì—ì„œ êº¼ë‚´ì“°ëŠ”\në°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. ë™ì‘ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ” ì½”ë“œì´ì§€ë§Œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ ì² ì €íˆ í•´ì•¼ í•œë‹¤ëŠ” ì , ì˜ë„í•œ ì‘ë™ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì  ë“±\nì „ì—­ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì˜€ì„ ë•Œì˜ ë¬¸ì œì ë“¤ì„ ì´ìœ ë¡œ ì§€ì ë°›ì•˜ìŠµë‹ˆë‹¤.\n\nì´ë¥¼ êµ¬í˜„í•˜ëŠ” ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ **Resolver** ë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### HandlerMethodArgumentResolver\n\nì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ì¸ìê°’ë“¤ì˜ ì „ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì§€ë§Œ ë©”ì„œë“œì— íŠ¹ì • ì–´ë…¸í…Œì´ì…˜ì„\në¶™í˜€ì„œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë°”ì¸ë”©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n`Header: Authorization` ì— Bearer í† í° ê°’ì„ ê²€ì¦í•˜ê³  í•„ìš”í•œ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ë„˜ê²¨ì£¼ëŠ”\nì‹¤ì œ ì½”ë“œë¥¼ ê°„ë‹¨íˆ ìš”ì•½í•œ ê²ƒì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.\n\n```java\n// ë°”ì¸ë”© ë§¤ê°œì²´ë¡œ ì‚¬ìš©í•  ì–´ë…¸í…Œì´ì…˜\n\n@Target({ElementType.PARAMETER})\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface AuthToken {\n    boolean required() default true;\n}\n```\n\n```java\n// Resolver ì •ì˜\n\n@Component\n@RequiredArgsConstructor\npublic class AuthTokenArgumentResolver implements HandlerMethodArgumentResolver {\n  \n    @Autowired\n    private TokenParser parser;\n  \n    // ì´ ë©”ì„œë“œì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„°ì¸ì§€ë¥¼ íŒë‹¨\n    @Override\n    public boolean supportsParameter(MethodParameter parameter) {\n        return parameter.getParameterAnnotation(AuthToken.class) != null;\n    }\n\n    // supportsParameter ì—ì„œ AuthToken ì–´ë…¸í…Œì´ì…˜ì´ ë‹¬ë¦° ì¸ìë¥¼ í™•ì¸í•˜ê³  Header ì˜ í† í°ê°’ì„ íŒŒì‹±í•˜ì—¬ í•´ë‹¹ ì¸ìì— ë°”ì¸ë”©.\n    @Override\n    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {\n        String authHeader = webRequest.getHeader(\"Authorization\");\n        if(authHeader != null) authHeader = authHeader.trim();\n        return parser.parse(authHeader);\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @PostMapping('/')\n    public void createUser(\n        @AuthToken Object token  // ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì—ì„œ íŒŒì‹±ë˜ì–´ í™œìš© ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ì•„ ì‚¬ìš©\n    ) {\n        String name = token.getUserName();\n    }\n}\n```\n\nì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ 'ê²€ì¦'ì— í•„ìš”í•œ ì½”ë“œë“¤ì„ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n---\n\n## ë°ì´í„°ë² ì´ìŠ¤\n\n### JPA\n\nìš”êµ¬ ì‚¬í•­ íŠ¹ì§• ìƒ ë³µì¡í•˜ê±°ë‚˜ ë™ì ì¸ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ê³  ë˜í•œ ë°ì´í„° ìì²´ê°€ ê°ì²´ë¡œì¨ íŠ¹ì •í• ë§Œí•œ ì—­í• ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—\n`mybatis` ë“±ê³¼ ê°™ì€ ORM ê°œë…ì´ ì—†ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë”ë¼ë„ ë¬¸ì œë  ê²ƒì€ ì—†ì—ˆìŠµë‹ˆë‹¤ë§Œ,\nê°œë°œìì˜ **ê°œë°œ í¸ì˜ì„±**ê³¼ ì´ ì—­ì‹œ **í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**ì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•˜ê¸° ìœ„í•´ JPA ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nê°€ì¥ ë¬´ë‚œí•œ `Hibernate` ORM í”„ë ˆì„ì›Œí¬ë¥¼ ì±„íƒí•˜ì˜€ìœ¼ë©° `JPQL` ë¡œ ì¿¼ë¦¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.\n\n### Replication\n\nRead-only ë©”ì„œë“œê°€ ì••ë„ì ìœ¼ë¡œ ë§ì€ ì„œë¹„ìŠ¤ íŠ¹ì„± ìƒ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” Master-Slave êµ¬ì¡°ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆê³  Slave ë°ì´í„°ë² ì´ìŠ¤ê°€\nRead íŠ¸ëœì­ì…˜ì„ ë‹´ë‹¹í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ì— ëŒ€í•´ì„œ Replication ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\n\n```java\n@Configuration\npublic class MasterDataSourceConfig {\n\n    @Primary\n    @Bean(name = \"masterDataSource\")\n    @ConfigurationProperties(prefix = \"spring.datasource.master.hikari\")\n    public DataSource masterDataSource() {\n        return DataSourceBuilder.create()\n            .type(HikariDataSource.class)\n            .build();\n    }\n}\n```\n\n```java\n@Configuration\npublic class SlaveDataSourceConfig {\n\n    @Bean(name = \"slaveDataSource\")\n    @ConfigurationProperties(prefix = \"spring.datasource.slave.hikari\")\n    public DataSource slaveDataSource() {\n        return DataSourceBuilder.create()\n            .type(HikariDataSource.class)\n            .build();\n    }\n}\n```\n\nMaster ì„¤ì •ê³¼ Slave ì„¤ì •ì„ ë‚˜ëˆ„ì–´ ê°ì²´ë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤. Property ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¸ DataSource ê°€ ìƒì„±ë©ë‹ˆë‹¤.\n\nDataSource ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë‹ˆ ë¼ìš°íŒ… í…Œì´ë¸”ê³¼ ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ê¸° ìœ„í•œ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.\n\n```java\n// Transaction ì„±ê²©ì— ë”°ë¼ ì—°ê²° ìœ í˜•ì„ ê²°ì •í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •\npublic class ReplicationRoutingDataSource extends AbstractRoutingDataSource {\n\n    @Override\n    protected Object determineCurrentLookupKey() {\n        TransactionSynchronizationManager.isCurrentTransactionReadOnly() ? DataSourceType.Slave : DataSourceType.Master;\n    }\n}\n```\n\n```java\npublic class RoutingDataSourceConfig {\n  \n    // Map ìƒì„±\n    @Bean(name = \"routingDataSource\")\n    public DataSource routingDataSource(\n        @Qualifier(\"masterDataSource\") final DataSource masterDataSource,\n        @Qualifier(\"slaveDataSource\") final DataSource slaveDataSource\n    ) {\n        ReplicationRoutingDataSource routingDataSource = new ReplicationRoutingDataSource();\n        Map\u003cObject, Object\u003e dataSourceMap = new HashMap\u003c\u003e();\n\n        dataSourceMap.put(DataSourceType.Master, masterDataSource);\n        if(useRdbSlave) dataSourceMap.put(DataSourceType.Slave, slaveDataSource);\n\n        routingDataSource.setTargetDataSources(dataSourceMap);\n        routingDataSource.setDefaultTargetDataSource(masterDataSource);\n\n        return routingDataSource;\n    }\n\n    // íŠ¸ëœì ì…˜ì´ ìƒì„±ë  ë•Œê°€ ì•„ë‹ˆë¼ ì‹¤ì œ ì¿¼ë¦¬ê°€ ë°œìƒí•  ë•Œì— connection ì„ ì ìœ í•˜ë„ë¡ ì„¤ì •\n    @Bean(name = \"dataSource\")\n    public DataSource dataSource(@Qualifier(\"routingDataSource\") DataSource routingDataSource) {\n        return new LazyConnectionDataSourceProxy(routingDataSource);\n    }\n\n    // EntityManagerFactory ì„¤ì •\n    @Bean(name = \"jpaEntityManagerFactory\")\n    public LocalContainerEntityManagerFactoryBean entityManagerFactory(@Qualifier(\"dataSource\") DataSource dataSource) {\n        Map\u003cString, Object\u003e prop = new HashMap\u003c\u003e();\n        prop.put(\"hibernate.physical_naming_strategy\", SpringPhysicalNamingStrategy.class.getName());\n        prop.put(\"hibernate.implicit_naming_strategy\", SpringImplicitNamingStrategy.class.getName());\n        prop.put(\"hibernate.hbm2ddl.auto\", env.getProperty(\"spring.jpa.hibernate.ddl-auto\"));\n\n        LocalContainerEntityManagerFactoryBean em = new LocalContainerEntityManagerFactoryBean();\n        em.setJpaVendorAdapter(new HibernateJpaVendorAdapter());\n        em.setDataSource(dataSource);\n        em.setPackagesToScan(\"common.jpa.entity\", \"gauth.jpa.entity\");\n        em.setPersistenceUnitName(\"jpaEntityManager\");\n        em.setJpaPropertyMap(prop);\n\n        return em;\n    }\n\n    // JpaTransactionManager êµ¬í˜„ ë° bean ìœ¼ë¡œ ë“±ë¡\n    @Bean(name = \"jpaTransactionManager\")\n    public PlatformTransactionManager jpaTransactionManager(EntityManagerFactory entityManagerFactory) {\n        JpaTransactionManager transactionManager = new JpaTransactionManager();\n        transactionManager.setEntityManagerFactory(entityManagerFactory);\n        return transactionManager;\n    }\n}\n```\n\nì„¤ì •ì„ ë§ˆì³¤ìœ¼ë‹ˆ ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ ë³„ë¡œ íŠ¸ëœì ì…˜ì˜ ì„±ê²©ì„ ì •í•´ì£¼ì–´ ì˜¬ë°”ë¥¸ ë°ì´í„°ë² ì´ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¼ìš°íŒ…ë˜ë„ë¡ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n  \n    @Transactional\n    @PostMapping('/')\n    public void createUser() {\n        // ...\n    }\n\n    @Transactional(readOnly = true)\n    @GetMapping('/')\n    public void getUserInfo() {\n        // ...\n    }\n}\n```\n\n## Exception\n\nì˜ˆì¸¡ ê°€ëŠ¥í•œ ë²”ìœ„ì˜ exception ë“¤ì€ ì»¤ìŠ¤í…€í•œ `RuntimeException` ì„ ë˜ì ¸ AOP ì—ì„œ ì•Œë§ëŠ” Response body ìƒì„±í•˜ì—¬\nì‘ë‹µí•˜ë„ë¡ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```java\npublic class BaseException extends RuntimeException {\n    public String code = \"9999\";\n    public String message = \"\";\n  \n    public BaseException(String code, String message) {\n        super(message);\n        this.code = code;\n        this.message = message;\n    }\n}\n```\n\n```java\n@Controller\n@RequestMapping('/user')\npublic class UserController {\n\n    @GetMapping('/')\n    public void getUserInfo(\n        @RequestBody UserReq body\n    ) {\n        // ...\n        User user = userService.getUserById(body.getUserId());\n        if (user == null) throw new BaseException(400, \"User ID is not found\");\n    }\n}\n```\n\n```java\npublic class GlobalExceptionHandler {\n    public static ResponseEntity\u003cBaseResponse\u003e handle(Exception e) {\n        if (e instanceof BaseException) {\n            code = ((BaseException) e).code;\n            message = ((BaseException) e).message;\n        }\n        return BaseResponse.toResponseEntity(code, message);\n    }\n}\n```\n\n```java\n@Aspect\n@Component\npublic class GlobalAspect {\n  \n    @Order(0)\n    @Around(\"within(controller..*)\")\n    public Object controllerAspect(ProceedingJoinPoint joinPoint) {\n        Object returnObject = null;\n        try {\n            returnObject = joinPoint.proceed();\n        } catch (Exception e) {\n            returnObject = GlobalExceptionHandler.handle(e);\n        }\n      \n        return returnObject;\n    }\n}\n```\n\nException ì´ ë°œìƒí•˜ë”ë¼ë„ ì›í•˜ëŠ” í˜•íƒœì˜ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në˜í•œ í”„ë ˆì„ì›Œí¬ì—ì„œ ë°œìƒì‹œí‚¤ëŠ” exception ë“¤ì˜ ê²½ìš°ë„ ì»¤ìŠ¤í…€í•œ exception ìœ¼ë¡œ ì²˜ë¦¬í•  í•„ìš”ê°€ ìˆì—ˆê¸° ë•Œë¬¸ì— `@ControllerAdvice` ê°ì²´ë¥¼ í†µí•´ ì²˜ë¦¬í•˜ë„ë¡ ì¶”ê°€ ì‘ì—…í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n```java\n@ControllerAdvice\npublic class GlobalExceptionHandler {\n    public static ResponseEntity\u003cBaseResponse\u003e handle(Exception e) {\n        if (e instanceof BaseException) {\n            code = ((BaseException) e).code;\n            message = ((BaseException) e).message;\n        }\n        return BaseResponse.toResponseEntity(code, message);\n    }\n  \n    /** \n     * RequestBody ì–´ë…¸í…Œì´ì…˜ì´ ìˆëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì„ì—ë„ ë¶ˆêµ¬í•˜ê³  JSON body ê°€ ì—†ëŠ” ê²½ìš°\n     */\n    @ExceptionHandler(HttpMessageNotReadableException.class)\n    @ResponseStatus(HttpStatus.BAD_REQUEST)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, HttpMessageNotReadableException e) {\n        return GlobalExceptionHandler.handle(new ParamVerifyException(\"Something is wrong with request body: \" + e.getMessage()));\n    }\n\n    /**\n     * RequestHeader ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ í—¤ë”ê°€ ë¹„ì–´ ìˆëŠ” ê²½ìš°\n     */\n    @ExceptionHandler(MissingRequestHeaderException.class)\n    @ResponseStatus(HttpStatus.OK)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, MissingRequestHeaderException e) {\n        return GlobalExceptionHandler.handle(new MissingMandatoryHeaderException(e.getMessage()));\n    }\n\n    /**\n     * RequestParam ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ëª…ì‹œëœ í•„ìˆ˜ ì…ë ¥ íŒŒë¼ë¯¸í„°ê°€ ëˆ„ë½ëœ ê²½ìš°\n     */\n    @ExceptionHandler(MissingServletRequestParameterException.class)\n    @ResponseStatus(HttpStatus.OK)\n    @ResponseBody\n    public ResponseEntity\u003cBaseResponseDto\u003e handle(HttpServletRequest req, MissingServletRequestParameterException e) {\n        return GlobalExceptionHandler.handle(req, new ParamVerifyException(e.getMessage()));\n    }\n}\n```\n\nìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë°œìƒ ê°€ëŠ¥í•œ Exception ì„ ìµœëŒ€í•œ ê³ ë ¤í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‹ë³„ ê°€ëŠ¥í•œ ì‘ë‹µì´ ë‚´ë ¤ê°€ë„ë¡ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n## ë¹Œë“œì™€ ë°°í¬\n\nDocker ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ êµ¬ë™í•˜ëŠ” ê¸°ì¡´ ë‹¤ë¥¸ ì„œë²„ì™€ ë™ì¼í•˜ê²Œ ë°°í¬ ë°©ì‹ì„ ê°€ì ¸ê°€ì•¼ í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ”\nì•„ë˜ì™€ ê°™ì€ ì ë“¤ì„ ê³ ë ¤í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.\n\n1. AWS ECS cluster ì— ì„œë¹„ìŠ¤ê°€ ë“±ë¡ë  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— SSH ì ‘ì†ì„ ìœ„í•œ ì¡°ì¹˜ê°€ í•„ìš”\n2. ELK êµ¬ì¡°ë¥¼ í†µí•´ ë¡œê·¸ë¥¼ AWS OpenSearch ì„œë¹„ìŠ¤ì— ì ì¬í•˜ë¯€ë¡œ filebeat ì„¤ì •ì´ í•„ìš”\n3. develop, stage, production ìœ¼ë¡œ 3ê°€ì§€ í™˜ê²½ì´ ë‚˜ëˆ„ì–´ì§€ë¯€ë¡œ ì¶”ê°€ ì„¤ì •ì´ í•„ìš”\n\në„ì»¤íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì‹¤ì œ ì½”ë“œë¥¼ ìƒëµí•˜ê³  ë™ì‘ ìˆœì„œë¥¼ ê°„ë‹¨íˆ ì„¤ëª…í•©ë‹ˆë‹¤.\n\n```dockerfile\n# alpine ë¦¬ëˆ…ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\nFROM alpine:3.15  \n# openjdk11-jre logrotate openssh filebeat ì„¤ì¹˜\n# project ë‚´ key file ì„ ADD í•˜ê³  ê¶Œí•œ ë¶€ì—¬\n# JAVA_HOME í™˜ê²½ ë³€ìˆ˜ ë“±ë¡\n# project ë‚´ ë°”ì´ë„ˆë¦¬ ì‹¤í–‰ scriptë¥¼ ADD (entrypoint.sh)\n# project ë‚´ filebeat ì„¤ì • íŒŒì¼ì„ ADD í•˜ê³  í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬\n# build ë˜ì–´ ìˆëŠ” jar íŒŒì¼ì„ ADD\nENTRYPOINT /root/entrypoint.sh\n```\n\në°°í¬ëŠ” git commit push ì‹œ pipeline ì´ ë™ì‘í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. íŒ€ ë‚´ í˜•ìƒ ê´€ë¦¬ëŠ” gitlab ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°\ngitlab ì˜ CI/CD ëŠ” pipeline ìœ¼ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. ì•„ë˜ëŠ” ì‹¤ì œ pipeline ì½”ë“œì—ì„œ í•µì‹¬ ì½”ë“œë§Œ ê°„ì¶”ë¦° ì˜ˆì‹œì…ë‹ˆë‹¤.\n\n```yml\nstages:\n  - versioning\n  - build\n  - deploy\n\nversioning-job:\n  stage: versioning\n  script:\n    - CURR_VER=$(cat build.gradle | grep \"version =\" | sed -E 's/version = \"(.*)\"$/\\1/')\n\nbuild-job:\n  stage: build\n  script:\n    - ./gradlew build\n    - docker build . -t cloud-v2-gauth\n\ndeploy-job:\n  stage: deploy\n  needs: [ \"versioning-job\", \"build-job\" ]\n  script:\n    #   aws-cli ECR login | AWS docker login\n    - TAG=\"$CI_COMMIT_BRANCH\"\n    - \u003e\n      if [ \"$CI_COMMIT_BRANCH\" = \"master\" ]; then\n        TAG=\"latest\"\n      fi\n  #   ì´ë¯¸ì§€ë¥¼ AWS ECR ì— í‘¸ì‹œ\n  dependencies:\n    - build-job\n```\n\nì´ì™€ ê°™ì´ êµ¬ì„±í•˜ì—¬ ì½”ë“œ í‘¸ì‹œê°€ ì¼ì–´ë‚œë‹¤ë©´ AWS ECR ì— ì´ë¯¸ì§€ê°€ ì—…ë°ì´íŠ¸ê°€ ë˜ê³ , ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë˜ë©´\nì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ (ê°œë°œ í™˜ê²½), í´ëŸ¬ìŠ¤í„° ì„œë¹„ìŠ¤ì˜ Task ì— ìƒˆ ë°°í¬ë¥¼ ì ìš©í•˜ì—¬ ì¬ì‹œì‘(ìŠ¤í…Œì´ì§€, ìƒìš© í™˜ê²½)í•˜ëŠ” ê²ƒìœ¼ë¡œ\nì‹ ê·œ ë²„ì „ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•©ë‹ˆë‹¤.\n"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"0"},"buildId":"9VLAmBO7HTcZ8hJKXyxbp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>