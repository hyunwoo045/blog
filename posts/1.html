<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/abefa9f2433dc1b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/abefa9f2433dc1b3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-d1728c3a778f1232.js" defer=""></script><script src="/_next/static/chunks/pages/_app-74903d276c4233f7.js" defer=""></script><script src="/_next/static/chunks/570-bdec8792f1cf9171.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-ca43962f59c7d3c7.js" defer=""></script><script src="/_next/static/cdtoWMg52IhiWI2Amhzpf/_buildManifest.js" defer=""></script><script src="/_next/static/cdtoWMg52IhiWI2Amhzpf/_ssgManifest.js" defer=""></script><style id="__jsx-971e8a04ba2bb225">.header.jsx-971e8a04ba2bb225{position:fixed;top:0;left:0;width:100%;height:60px;-webkit-box-shadow:0 2px 4px rgba(0,0,0,.1);-moz-box-shadow:0 2px 4px rgba(0,0,0,.1);box-shadow:0 2px 4px rgba(0,0,0,.1);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.logo.jsx-971e8a04ba2bb225{position:relative;left:10px;width:55px;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;opacity:.6;background-color:#f00;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer}.header__title.jsx-971e8a04ba2bb225{margin-left:34px;font-size:18px;cursor:pointer}.header__nav.jsx-971e8a04ba2bb225{position:absolute;right:20px;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item.jsx-971e8a04ba2bb225:before{content:"";width:1px;height:12px;background-color:#e5e5e5;position:absolute;top:0;bottom:0;margin:auto}.nav__item.jsx-971e8a04ba2bb225:first-child:before{display:none}.nav__item.jsx-971e8a04ba2bb225{position:relative;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;.nav__item__inner.jsx-971e8a04ba2bb225{display:block;font-size:12px;padding:11px 24px;color:#656565}}}}</style><style id="__jsx-4eaf6378c4a9ee0a">.page__content.jsx-4eaf6378c4a9ee0a{width:76%;margin:auto}pre.jsx-4eaf6378c4a9ee0a{font-size:11px}</style></head><body><div id="__next"><div class="jsx-971e8a04ba2bb225 header"><div class="jsx-971e8a04ba2bb225 logo"><img alt="main" loading="lazy" width="55" height="55" decoding="async" data-nimg="1" style="color:transparent" src="/images/ori_running.gif"/></div><div class="jsx-971e8a04ba2bb225 header__title">레로로의 개발 브이로그 🏝</div><div class="jsx-971e8a04ba2bb225 header__nav"><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner">about</span></div><div class="jsx-971e8a04ba2bb225 nav__item"><span class="jsx-971e8a04ba2bb225 nav__item__inner"><a href="https://github.com/hyunwoo045"><img alt="github_logo" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/images/github_icon.png"/></a></span></div></div></div><main><div class="post__content"><section class="jsx-4eaf6378c4a9ee0a page__content e-content"><ul>
<li>기간: 2022. 11 ~ 2022. 12, 약 2개월</li>
<li>주요 업무: 코맥스 클라우드 2.0 어드민 페이지 내 리소스 버전 등록 페이지 개발</li>
<li>업무 목적: 실제 유통된 리소스(월패드, 로비폰 등) 내 어플리케이션 버전 등록/업데이트를 위한 페이지 개발</li>
<li>개발 인원: 1인</li>
<li>프로젝트 스펙<!-- -->
<ul>
<li>Spring Boot</li>
<li>Spring Web MVC</li>
<li>Spring Security</li>
<li>QueryDSL</li>
<li>Vue.js</li>
</ul>
</li>
</ul>
<p>기존 코맥스 클라우드 2.0 의 관리자 페이지에 OTA(Over The Air) 기능을 추가하는 개발 건의
여러 요구사항 중 신규 버전 등록을 위한 페이지를 개발하는 업무를 담당하게 되었습니다.</p>
<hr/>
<h2>프로젝트 구조 분석</h2>
<p>기본적으로 Spring Web MVC 프레임워크를 사용한 프로젝트로 Apache Tiles 라이브러리를 사용하여
타일 기반의 레이아웃을 구현한 것으로 보입니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token annotation" style="color:#999">@Configuration</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">WebMvcConfig</span><span> </span><span class="token" style="color:#07a">implements</span><span> </span><span class="token" style="color:#DD4A68">WebMvcConfigurer</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">void</span><span> </span><span class="token" style="color:#DD4A68">configureViewResolvers</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">ViewResolverRegistry</span><span> registry</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">TilesViewResolver</span><span> viewResolver </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">TilesViewResolver</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        registry</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">viewResolver</span><span class="token" style="color:#999">(</span><span>viewResolver</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Bean</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">TilesConfigurer</span><span> </span><span class="token" style="color:#DD4A68">tilesConfigurer</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">TilesConfigurer</span><span> tilesConfigurer </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">TilesConfigurer</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        tilesConfigurer</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setDefinitions</span><span class="token" style="color:#999">(</span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">String</span><span class="token" style="color:#999">[</span><span class="token" style="color:#999">]</span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:#690">&quot;/WEB-INF/layouts/**/*.tiles.xml&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>            </span><span class="token" style="color:#690">&quot;/WEB-INF/views/**/*.tiles.xml&quot;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        tilesConfigurer</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">setCheckRefresh</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">true</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> tilesConfigurer</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>여러 많은 타일들이 정의되어 있지만 가장 핵심으로 보이는 레이아웃 구성은 아래 코드입니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-html" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">&lt;!--page.layout.jsp--&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">html</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">lang</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">ko</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">head</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">title</span><span class="token" style="color:#999">&gt;</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">title</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:slategray">&lt;!--....--&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">head</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">body</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">div</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">class</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">page-container</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">div</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">class</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">page-content</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905;-opacity:.7">tiles:</span><span class="token" style="color:#905">insertAttribute</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">leftmenu</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">/&gt;</span><span>
</span><span>        </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">div</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">class</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">content-wrapper</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>            </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">div</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">class</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">content</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>                </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905;-opacity:.7">tiles:</span><span class="token" style="color:#905">insertAttribute</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">body</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">/&gt;</span><span>
</span><span>                </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905;-opacity:.7">tiles:</span><span class="token" style="color:#905">insertAttribute</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">footer</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">/&gt;</span><span>
</span><span>            </span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">div</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">div</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">div</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">div</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">body</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">html</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<p>메인 페이지의 레이아웃을 정의한 모습입니다. 아주 간단해 보이는 HTML 구성이며, body attribute 에 구현한 레이아웃을 삽입할 수 있는 것으로 보입니다. 이 구성에
맞춰 <code class="jsx-4eaf6378c4a9ee0a ">/WEB-INF/views/resource/resourcevermng</code> 라는 버전 관리 페이지의 디렉토리를 생성해주고 <code class="jsx-4eaf6378c4a9ee0a ">views.tiles.xml</code> 파일을 생성하여 새로 만들 타일의 설정을 해주었습니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-html" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">tiles-definitions</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">definition</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">resource/resourcevermng/*</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">extends</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">page.layout</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">put-attribute</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">name</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">body</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">value</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">/WEB-INF/views/resource/resourcevermng/{1}.jsp</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">/&gt;</span><span>
</span><span>    </span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">definition</span><span class="token" style="color:#999">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">tiles-definitions</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<p><code class="jsx-4eaf6378c4a9ee0a ">resourcemng.jsp</code> 파일을 생성하여 실제 랜더링 될 페이지의 템플릿을 정의합니다. 페이지를 구성하는 프레임워크는 Vue.js 이므로 Vue.js 의 템플릿 문법에 대한 기억을 더듬어가며 코딩하였습니다.
세부 코드는 생략합니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-html" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">div</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">id</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">rootVM</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">v-cloak</span><span class="token" style="color:#999">&gt;</span><span>
</span><span>    </span><span class="token" style="color:slategray">&lt;!--...--&gt;</span><span>
</span><span></span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">div</span><span class="token" style="color:#999">&gt;</span><span>
</span>
<span></span><span class="token" style="color:#999">&lt;</span><span class="token" style="color:#905">script</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">type</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">text/javascript</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#905"> </span><span class="token" style="color:#690">src</span><span class="token attr-equals" style="color:#999">=</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#07a">${contextPath}/app/resource/resourcevermng/resourcevermng.js</span><span class="token" style="color:#999">&quot;</span><span class="token" style="color:#999">/&gt;</span></code></div></pre>
<p>최초 프로젝트를 구현한 분의 의도를 정확히 파악할 수는 없으나, 한 파일에 template 과 script 코드가 모두 다 들어가 가독성을 해치는 것을 방지하기 위함이 아니었을까 생각됩니다. <code class="jsx-4eaf6378c4a9ee0a ">contextPath</code>
는 constant 전역 변수로써 <code class="jsx-4eaf6378c4a9ee0a ">/src/resources/static</code> 입니다.</p>
<p><code class="jsx-4eaf6378c4a9ee0a ">src</code> attribute 에 정의된 파일을 생성하고 코드를 작성하였습니다. 세부 코드는 생략합니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">const</span><span> rootVM </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">Vue</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token literal-property" style="color:#905">name</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;RootVM&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#905">el</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;#rootVM&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#DD4A68">created</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#905">data</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#905">computed</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#905">methods</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span></code></div></pre>
<p>페이지 레이 아웃의 구성을 마쳤으니 이제 Resolver 가 <code class="jsx-4eaf6378c4a9ee0a ">resource/resourcevermng/*</code> 이름의 타일을 불러올 수 있도록 컨트롤러 메서드를 구현합니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token annotation" style="color:#999">@Controller</span><span>
</span><span></span><span class="token annotation" style="color:#999">@RequestMapping</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;/resource/resourcevermng&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">ResourceVersionManageController</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@GetMappging</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;/&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> </span><span class="token" style="color:#DD4A68">index</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">Model</span><span> model</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:slategray">// model.addAttribute()  필요한 데이터를 보내줍니다.</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#690">&quot;/resource/resourcevermng/resourcevermng&quot;</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<hr/>
<h3>QueryDSL</h3>
<p>요구되는 페이지 기능 상 쿼리가 필요하기 때문에 그에 관련 된 구조 또한 파악할 필요가 있었습니다. Spring 의 ORM 스펙 중 하나인 <code class="jsx-4eaf6378c4a9ee0a ">QueryDSL</code>
을 사용하고 있습니다. 부분 필터링 기능을 구현해야 하는 어드민 페이지이었기 때문에 <code class="jsx-4eaf6378c4a9ee0a ">QueryDSL</code> 채택은 아주 합리적이라고 생각합니다.</p>
<p>실제 구현한 코드를 예시로 들며 설명해보겠습니다.</p>
<p><img src="/images/ota/1.png" alt="ota_resource_vermng"/></p>
<p>화면에 보이듯 총 7개의 검색 필드가 존재하는데 7개의 필드를 모두 다 채워 검색해야 한다면 사용성이 매우 떨어지니 당연히 일부 필드만 채워 검색하더라도 필터가 적용된 검색 결과를 보여주어야 합니다. 이를 JPA 의
일반적인 쿼리 메서드로 구현한다고 하면 이 한 기능을 위해 수도 없이 많은 메서드를 정의해야 했을 것입니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">// 실제 코드가 아닌 예시입니다.</span><span>
</span>
<span></span><span class="token annotation" style="color:#999">@Repository</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">interface</span><span> </span><span class="token" style="color:#DD4A68">ResourceVersionRepository</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">JpaRepository</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">ResourceVersion</span><span class="token generics" style="color:#999">,</span><span class="token generics"> </span><span class="token generics" style="color:#DD4A68">Long</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#DD4A68">List</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">ResourceVersion</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">findByModelName</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span> modelName</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#DD4A68">List</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">ResourceVersion</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">findByModelNameAndModelType</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span> modelName</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> modelType</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#DD4A68">List</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">ResourceVersion</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">findByModelNameAndModelTypeAndVersion</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span> modelName</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> modelType</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> version</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:slategray">// .....수십개의 method T_T</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>이런 상황에서는 동적 쿼리가 작성 가능한 방법을 찾아야 하는데 <code class="jsx-4eaf6378c4a9ee0a ">QueryDSL</code> 은 이를 해결해줄 JPQL 빌더입니다.</p>
<p>기존 설정이 이미 완료되어 있고 컴파일 시 <code class="jsx-4eaf6378c4a9ee0a ">/target/generated-sources/java/{package}/entity</code> 아래 QModel 들이 생성되는 것을 확인하였으니 추가된 테이블을 정의합니다. 실제
코드와는 다른 예시입니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token annotation" style="color:#999">@Entity</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Getter</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Setter</span><span>
</span><span></span><span class="token annotation" style="color:#999">@Table</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;tbl_resource_version&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">ResourceVersion</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Id</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@GeneratedValue</span><span class="token" style="color:#999">(</span><span>strategy </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">GenerationType</span><span class="token" style="color:#999">.</span><span>IDENTITY</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@Column</span><span class="token" style="color:#999">(</span><span>columnDefinition </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;int&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">Long</span><span> seqno</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@ManyToOne</span><span class="token" style="color:#999">(</span><span>fetch </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#DD4A68">FetchType</span><span class="token" style="color:#999">.</span><span>LAZY</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token annotation" style="color:#999">@JoinColumn</span><span class="token" style="color:#999">(</span><span>name </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;modelSeqno&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">ResourceModel</span><span> model</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> version</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> registerAdmin</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">String</span><span> updateAdmin</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Column</span><span class="token" style="color:#999">(</span><span>columnDefinition </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;int&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">Long</span><span> registerTs</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Column</span><span class="token" style="color:#999">(</span><span>columnDefinition </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#690">&quot;int&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">Long</span><span> updateTs</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>이 후 다시 컴파일하면 <code class="jsx-4eaf6378c4a9ee0a ">QResourceVersion</code> 이라는 새로운 QModel 이 생성된 것을 볼 수 있습니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token annotation" style="color:#999">@Generated</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;com.querydsl.codegen.EntitySerializer&quot;</span><span class="token" style="color:#999">)</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">QResourceVersion</span><span> </span><span class="token" style="color:#07a">extends</span><span> </span><span class="token" style="color:#DD4A68">EntityPathBase</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">ResourceVersion</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:slategray">//...</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>동적 쿼리를 작성합니다. 역시 실제 코드와 다른 예시입니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-java" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token annotation" style="color:#999">@Repository</span><span>
</span><span></span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">class</span><span> </span><span class="token" style="color:#DD4A68">ResourceVersionRepository</span><span> </span><span class="token" style="color:#999">{</span><span>
</span>
<span>    </span><span class="token annotation" style="color:#999">@Autowired</span><span>
</span><span>    </span><span class="token" style="color:#07a">private</span><span> </span><span class="token" style="color:#DD4A68">JPAQueryFactory</span><span> queryFactory</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token doc-comment" style="color:slategray">/**
</span><span class="token doc-comment" style="color:slategray">     * SearchMap 은 ServletRequest 를 HashMap</span><span class="token doc-comment" style="color:#999">&lt;</span><span class="token doc-comment" style="color:#905">String,</span><span class="token doc-comment" style="color:#905"> </span><span class="token doc-comment" style="color:#690">Object</span><span class="token doc-comment" style="color:#999">&gt;</span><span class="token doc-comment" style="color:slategray"> 의 형태로 변환시킨 객체입니다.
</span><span class="token doc-comment" style="color:slategray">     */</span><span>
</span><span>    </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#DD4A68">QueryResults</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">Tuple</span><span class="token generics" style="color:#999">&gt;</span><span> </span><span class="token" style="color:#DD4A68">queryVersionList</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">SearchMap</span><span> map</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">Sort</span><span> sort</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">BooleanBuilder</span><span> filter </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">BooleanBuilder</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">QResourceVersion</span><span> v </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">QResourceVersion</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;v&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#DD4A68">QResourceModel</span><span> m </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">QResourceModel</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;m&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>map </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:#DD4A68">String</span><span> modelName </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span class="token" style="color:#999">)</span><span> map</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;modelName&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:#DD4A68">String</span><span> modelType </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span class="token" style="color:#999">)</span><span> map</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;modelType&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:#DD4A68">String</span><span> version </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">String</span><span class="token" style="color:#999">)</span><span> map</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">get</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">&quot;version&quot;</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>            </span><span class="token" style="color:slategray">// 동적 쿼리 조건문 추가 </span><span>
</span><span>            </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>modelName </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> filter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span>m</span><span class="token" style="color:#999">.</span><span>modelName</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">eq</span><span class="token" style="color:#999">(</span><span>modelName</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>modelType </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> filter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span>m</span><span class="token" style="color:#999">.</span><span>modelType</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">eq</span><span class="token" style="color:#999">(</span><span>modelType</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            </span><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>version </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!=</span><span> </span><span class="token" style="color:#07a">null</span><span class="token" style="color:#999">)</span><span> filter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span>v</span><span class="token" style="color:#999">.</span><span>version</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">eq</span><span class="token" style="color:#999">(</span><span>version</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>            </span><span class="token" style="color:slategray">// 쿼리 실행</span><span>
</span><span>            </span><span class="token" style="color:#DD4A68">JPAQuery</span><span class="token generics" style="color:#999">&lt;</span><span class="token generics" style="color:#DD4A68">Tuple</span><span class="token generics" style="color:#999">&gt;</span><span> query </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> queryFactory
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">select</span><span class="token" style="color:#999">(</span><span>m</span><span class="token" style="color:#999">.</span><span>modelName</span><span class="token" style="color:#999">,</span><span> m</span><span class="token" style="color:#999">.</span><span>modelType</span><span class="token" style="color:#999">,</span><span> v</span><span class="token" style="color:#999">.</span><span>version</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">from</span><span class="token" style="color:#999">(</span><span>v</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">leftJoin</span><span class="token" style="color:#999">(</span><span>v</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">model</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> m</span><span class="token" style="color:#999">)</span><span>
</span><span>                </span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">where</span><span class="token" style="color:#999">(</span><span>filter</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span>            </span><span class="token" style="color:#07a">return</span><span> query</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">fetResults</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">else</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>            </span><span class="token" style="color:slategray">// 필터 없이 전체 검색...</span><span>
</span><span>        </span><span class="token" style="color:#999">}</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span></code></div></pre>
<p>이 후 <code class="jsx-4eaf6378c4a9ee0a ">QueryResults&lt;Tuple&gt;</code> 형태의 결과값은 DTO 형태로 변환하여 페이지에 전달하도록 구현하였습니다.</p>
<hr/>
<h2>AWS S3 에 바이너리 업로드</h2>
<p>JavaScript 용 AWS SDK 가
있습니다. <a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/welcome.html">공식 문서</a> 를 참고하여 AWS S3 에 업로드가
가능하도록 구현하였습니다.</p>
<p>앞단은 엄밀히 따지자면 Node.js 프로젝트가 아니므로 브라우저 스크립트로 SDK 를 포함시켜야 했습니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-html" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:slategray">&lt;!--resourcevermng.jsp--&gt;</span><span>
</span>
<span></span><span class="token" style="color:slategray">&lt;!-- ..... --&gt;</span><span>
</span><span>&lt;script src=&quot;https://sdk.amazonaws.com/js/aws-sdk-2.1254.0.min.js&gt;</span><span class="token" style="color:#999">&lt;/</span><span class="token" style="color:#905">script</span><span class="token" style="color:#999">&gt;</span></code></div></pre>
<p>AWS 접근 권한을 부여하기
위해 <a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/getting-started-browser.html">공식 문서</a> 의 1단계,
2단계 내용을 참고하여 CognitoIdentity Pool 을 생성하고 정책을 부여하였습니다. 이 후 권한을 가진 Pool ID 를 받을 수 있습니다. 이를 바탕으로 포함시킨 SDK 를 확장합니다.</p>
<p>마지막으로 역시 공식 문서를 참조하여 페이지에서 전달받은 바이너리 파일을 AWS S3에 업로드 하였습니다.</p>
<pre><div style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-js" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">async</span><span> </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">uploadFileToS3</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:slategray">// ...v-model &gt; closure. file 에 관한 정보를 가져옴</span><span>
</span>    
<span>    </span><span class="token" style="color:#07a">var</span><span> credentials </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">AWS</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">CognitoIdentityCredentials</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">IdentityPoolId</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;ap-northeast-2:key...&#x27;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#905">AWS</span><span class="token" style="color:#999">.</span><span class="token property-access">config</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">update</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">region</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;ap-northeast-2&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>        credentials</span><span class="token" style="color:#999">,</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#07a">let</span><span> s3 </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#07a">new</span><span> </span><span class="token" style="color:#DD4A68">AWS</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">s3</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">computeChecksums</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#905">true</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#07a">let</span><span> body </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">Bucket</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&#x27;bucket-name&#x27;</span><span class="token" style="color:#999">,</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">Body</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> file</span><span class="token" style="color:#999">,</span><span>
</span><span>        </span><span class="token literal-property" style="color:#905">Key</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> fileName
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span>    </span><span class="token" style="color:#07a">const</span><span> putResult </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token control-flow" style="color:#07a">await</span><span> s3</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">putObject</span><span class="token" style="color:#999">(</span><span>body</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token method property-access" style="color:#DD4A68">promise</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></div></pre></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":1,"title":"관리자 페이지 - 버전 등록 페이지 개발","date":"2022-12-17","tag":["Spring Boot","Spring JPA","Spring Web","QueryDSL","Vue.js"],"content":"\n- 기간: 2022. 11 ~ 2022. 12, 약 2개월\n- 주요 업무: 코맥스 클라우드 2.0 어드민 페이지 내 리소스 버전 등록 페이지 개발\n- 업무 목적: 실제 유통된 리소스(월패드, 로비폰 등) 내 어플리케이션 버전 등록/업데이트를 위한 페이지 개발\n- 개발 인원: 1인\n- 프로젝트 스펙\n    - Spring Boot\n    - Spring Web MVC\n    - Spring Security\n    - QueryDSL\n    - Vue.js\n\n기존 코맥스 클라우드 2.0 의 관리자 페이지에 OTA(Over The Air) 기능을 추가하는 개발 건의\n여러 요구사항 중 신규 버전 등록을 위한 페이지를 개발하는 업무를 담당하게 되었습니다.\n\n---\n\n## 프로젝트 구조 분석\n\n기본적으로 Spring Web MVC 프레임워크를 사용한 프로젝트로 Apache Tiles 라이브러리를 사용하여\n타일 기반의 레이아웃을 구현한 것으로 보입니다.\n\n```java\n\n@Configuration\npublic class WebMvcConfig implements WebMvcConfigurer {\n    public void configureViewResolvers(ViewResolverRegistry registry) {\n        TilesViewResolver viewResolver = new TilesViewResolver();\n        registry.viewResolver(viewResolver);\n    }\n\n    @Bean\n    public TilesConfigurer tilesConfigurer() {\n        TilesConfigurer tilesConfigurer = new TilesConfigurer();\n        tilesConfigurer.setDefinitions(new String[]{\n            \"/WEB-INF/layouts/**/*.tiles.xml\",\n            \"/WEB-INF/views/**/*.tiles.xml\"\n        });\n        tilesConfigurer.setCheckRefresh(true);\n        return tilesConfigurer;\n    }\n}\n```\n\n여러 많은 타일들이 정의되어 있지만 가장 핵심으로 보이는 레이아웃 구성은 아래 코드입니다.\n\n```html\n\u003c!--page.layout.jsp--\u003e\n\u003chtml lang=\"ko\"\u003e\n\u003chead\u003e\n    \u003ctitle\u003e\u003c/title\u003e\n    \u003c!--....--\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv class=\"page-container\"\u003e\n    \u003cdiv class=\"page-content\"\u003e\n        \u003ctiles:insertAttribute name=\"leftmenu\"/\u003e\n        \u003cdiv class=\"content-wrapper\"\u003e\n            \u003cdiv class=\"content\"\u003e\n                \u003ctiles:insertAttribute name=\"body\"/\u003e\n                \u003ctiles:insertAttribute name=\"footer\"/\u003e\n            \u003c/div\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\n메인 페이지의 레이아웃을 정의한 모습입니다. 아주 간단해 보이는 HTML 구성이며, body attribute 에 구현한 레이아웃을 삽입할 수 있는 것으로 보입니다. 이 구성에\n맞춰 `/WEB-INF/views/resource/resourcevermng` 라는 버전 관리 페이지의 디렉토리를 생성해주고 `views.tiles.xml` 파일을 생성하여 새로 만들 타일의 설정을 해주었습니다.\n\n```html\n\n\u003ctiles-definitions\u003e\n    \u003cdefinition name=\"resource/resourcevermng/*\" extends=\"page.layout\"\u003e\n        \u003cput-attribute name=\"body\" value=\"/WEB-INF/views/resource/resourcevermng/{1}.jsp\"/\u003e\n    \u003c/definition\u003e\n\u003c/tiles-definitions\u003e\n```\n\n`resourcemng.jsp` 파일을 생성하여 실제 랜더링 될 페이지의 템플릿을 정의합니다. 페이지를 구성하는 프레임워크는 Vue.js 이므로 Vue.js 의 템플릿 문법에 대한 기억을 더듬어가며 코딩하였습니다.\n세부 코드는 생략합니다.\n\n```html\n\n\u003cdiv id=\"rootVM\" v-cloak\u003e\n    \u003c!--...--\u003e\n\u003c/div\u003e\n\n\u003cscript type=\"text/javascript\" src=\"${contextPath}/app/resource/resourcevermng/resourcevermng.js\"/\u003e\n```\n\n최초 프로젝트를 구현한 분의 의도를 정확히 파악할 수는 없으나, 한 파일에 template 과 script 코드가 모두 다 들어가 가독성을 해치는 것을 방지하기 위함이 아니었을까 생각됩니다. `contextPath`\n는 constant 전역 변수로써 `/src/resources/static` 입니다.\n\n`src` attribute 에 정의된 파일을 생성하고 코드를 작성하였습니다. 세부 코드는 생략합니다.\n\n```js\nconst rootVM = new Vue({\n    name: 'RootVM',\n    el: '#rootVM',\n    created() {\n    },\n    data: {},\n    computed: {},\n    methods: {}\n})\n```\n\n페이지 레이 아웃의 구성을 마쳤으니 이제 Resolver 가 `resource/resourcevermng/*` 이름의 타일을 불러올 수 있도록 컨트롤러 메서드를 구현합니다.\n\n```java\n\n@Controller\n@RequestMapping(\"/resource/resourcevermng\")\npublic class ResourceVersionManageController {\n\n    @GetMappging(\"/\")\n    public String index(Model model) {\n        // model.addAttribute()  필요한 데이터를 보내줍니다.\n        return \"/resource/resourcevermng/resourcevermng\";\n    }\n}\n```\n\n---\n\n### QueryDSL\n\n요구되는 페이지 기능 상 쿼리가 필요하기 때문에 그에 관련 된 구조 또한 파악할 필요가 있었습니다. Spring 의 ORM 스펙 중 하나인 `QueryDSL`\n을 사용하고 있습니다. 부분 필터링 기능을 구현해야 하는 어드민 페이지이었기 때문에 `QueryDSL` 채택은 아주 합리적이라고 생각합니다.\n\n실제 구현한 코드를 예시로 들며 설명해보겠습니다.\n\n![ota_resource_vermng](/images/ota/1.png)\n\n화면에 보이듯 총 7개의 검색 필드가 존재하는데 7개의 필드를 모두 다 채워 검색해야 한다면 사용성이 매우 떨어지니 당연히 일부 필드만 채워 검색하더라도 필터가 적용된 검색 결과를 보여주어야 합니다. 이를 JPA 의\n일반적인 쿼리 메서드로 구현한다고 하면 이 한 기능을 위해 수도 없이 많은 메서드를 정의해야 했을 것입니다.\n\n```java\n// 실제 코드가 아닌 예시입니다.\n\n@Repository\npublic interface ResourceVersionRepository extends JpaRepository\u003cResourceVersion, Long\u003e {\n    List\u003cResourceVersion\u003e findByModelName(String modelName);\n\n    List\u003cResourceVersion\u003e findByModelNameAndModelType(String modelName, String modelType);\n\n    List\u003cResourceVersion\u003e findByModelNameAndModelTypeAndVersion(String modelName, String modelType, String version);\n    // .....수십개의 method T_T\n}\n```\n\n이런 상황에서는 동적 쿼리가 작성 가능한 방법을 찾아야 하는데 `QueryDSL` 은 이를 해결해줄 JPQL 빌더입니다.\n\n기존 설정이 이미 완료되어 있고 컴파일 시 `/target/generated-sources/java/{package}/entity` 아래 QModel 들이 생성되는 것을 확인하였으니 추가된 테이블을 정의합니다. 실제\n코드와는 다른 예시입니다.\n\n```java\n\n@Entity\n@Getter\n@Setter\n@Table(name = \"tbl_resource_version\")\npublic class ResourceVersion {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(columnDefinition = \"int\")\n    private Long seqno;\n\n    @ManyToOne(fetch = FetchType.LAZY)\n    @JoinColumn(name = \"modelSeqno\")\n    private ResourceModel model;\n\n    private String version;\n\n    private String registerAdmin;\n\n    private String updateAdmin;\n\n    @Column(columnDefinition = \"int\")\n    private Long registerTs;\n\n    @Column(columnDefinition = \"int\")\n    private Long updateTs;\n}\n```\n\n이 후 다시 컴파일하면 `QResourceVersion` 이라는 새로운 QModel 이 생성된 것을 볼 수 있습니다.\n\n```java\n\n@Generated(\"com.querydsl.codegen.EntitySerializer\")\npublic class QResourceVersion extends EntityPathBase\u003cResourceVersion\u003e {\n    //...\n}\n```\n\n동적 쿼리를 작성합니다. 역시 실제 코드와 다른 예시입니다.\n\n```java\n\n@Repository\npublic class ResourceVersionRepository {\n\n    @Autowired\n    private JPAQueryFactory queryFactory;\n\n    /**\n     * SearchMap 은 ServletRequest 를 HashMap\u003cString, Object\u003e 의 형태로 변환시킨 객체입니다.\n     */\n    public QueryResults\u003cTuple\u003e queryVersionList(SearchMap map, Sort sort) {\n        BooleanBuilder filter = new BooleanBuilder();\n        QResourceVersion v = new QResourceVersion(\"v\");\n        QResourceModel m = new QResourceModel(\"m\");\n\n        if (map != null) {\n            String modelName = (String) map.get(\"modelName\");\n            String modelType = (String) map.get(\"modelType\");\n            String version = (String) map.get(\"version\");\n\n            // 동적 쿼리 조건문 추가 \n            if (modelName != null) filter.and(m.modelName.eq(modelName));\n            if (modelType != null) filter.and(m.modelType.eq(modelType));\n            if (version != null) filter.and(v.version.eq(version));\n\n            // 쿼리 실행\n            JPAQuery\u003cTuple\u003e query = queryFactory\n                .select(m.modelName, m.modelType, v.version)\n                .from(v)\n                .leftJoin(v.model(), m)\n                .where(filter);\n\n            return query.fetResults();\n        } else {\n            // 필터 없이 전체 검색...\n        }\n    }\n}\n```\n\n이 후 `QueryResults\u003cTuple\u003e` 형태의 결과값은 DTO 형태로 변환하여 페이지에 전달하도록 구현하였습니다.\n\n---\n\n## AWS S3 에 바이너리 업로드\n\nJavaScript 용 AWS SDK 가\n있습니다. [공식 문서](https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/welcome.html) 를 참고하여 AWS S3 에 업로드가\n가능하도록 구현하였습니다.\n\n앞단은 엄밀히 따지자면 Node.js 프로젝트가 아니므로 브라우저 스크립트로 SDK 를 포함시켜야 했습니다.\n\n```html\n\u003c!--resourcevermng.jsp--\u003e\n\n\u003c!-- ..... --\u003e\n\u003cscript src=\"https://sdk.amazonaws.com/js/aws-sdk-2.1254.0.min.js\u003e\u003c/script\u003e\n```\n\nAWS 접근 권한을 부여하기\n위해 [공식 문서](https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/getting-started-browser.html) 의 1단계,\n2단계 내용을 참고하여 CognitoIdentity Pool 을 생성하고 정책을 부여하였습니다. 이 후 권한을 가진 Pool ID 를 받을 수 있습니다. 이를 바탕으로 포함시킨 SDK 를 확장합니다.\n\n마지막으로 역시 공식 문서를 참조하여 페이지에서 전달받은 바이너리 파일을 AWS S3에 업로드 하였습니다.\n\n```js\nasync function uploadFileToS3() {\n    // ...v-model \u003e closure. file 에 관한 정보를 가져옴\n    \n    var credentials = new AWS.CognitoIdentityCredentials({\n        IdentityPoolId: 'ap-northeast-2:key...'\n    });\n    AWS.config.update({\n        region: 'ap-northeast-2',\n        credentials,\n    });\n    let s3 = new AWS.s3({\n        computeChecksums: true\n    });\n    let body = {\n        Bucket: 'bucket-name',\n        Body: file,\n        Key: fileName\n    }\n    const putResult = await s3.putObject(body).promise();\n}\n\n```\n\n"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"1"},"buildId":"cdtoWMg52IhiWI2Amhzpf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>